# سیاست دسترسی CRM املاک

نسخه: 2.0  
آخرین بروزرسانی: 2026-02-27

این سند مرجع نهایی دسترسی‌ها در پروژه است.  
هدف: امنیت بالا، سادگی برای استفاده روزمره، و مقیاس‌پذیری برای پروژه بزرگ.

## 1) اصول ثابت

1. اصل `Default Deny`:
- هر دسترسی که صراحتا داده نشده باشد، ممنوع است.

2. بک‌اند مرجع نهایی است:
- UI فقط نمایش می‌دهد.
- اعتبارسنجی و رد دسترسی نامجاز باید در بک‌اند انجام شود.

3. کاربر معمولی پنل ندارد:
- کاربران معمولی سایت (`user`) نباید هیچ دسترسی به پنل ادمین داشته باشند.

4. نقش‌ها قابل سفارشی‌سازی هستند:
- Admin و Consultant می‌توانند دسترسی‌های متفاوت داشته باشند.
- اما قواعد امنیتی سطح بالا (بخش 4) همیشه اعمال می‌شود.

## 2) نقش‌ها

### Super Admin
- دسترسی کامل به همه ماژول‌ها.
- تنها نقش مجاز برای عملیات امنیتی و ساختاری حساس.
- می‌تواند Admin عادی را به Super Admin ارتقا دهد.

### Admin
- کاربر مدیریتی پنل.
- می‌تواند دسترسی‌های متفاوت داشته باشد (مبتنی بر Role/Permission).
- به‌صورت پیش‌فرض سوپرادمین نیست.

### Consultant
- کاربر عملیاتی املاک.
- می‌تواند دسترسی‌های متفاوت داشته باشد (حتی محتوایی مثل بلاگ در صورت نیاز کسب‌وکار).
- هرگز نباید Super Admin شود.

### User (کاربر معمولی)
- فقط دسترسی فرانت/اپ.
- بدون دسترسی پنل ادمین.

## 3) سیاست عملیاتی ساده (برای استفاده واقعی)

1. سه لایه روشن برای تیم:
- `Super Admin`
- `Admin`
- `Consultant`

2. انعطاف کنترل‌شده:
- برای Admin و Consultant می‌توان Roleهای مختلف تعریف کرد.
- هر Role می‌تواند ماژول و عملیات متفاوت داشته باشد.

3. سناریوی کسب‌وکار مجاز:
- اگر نیاز باشد Consultant به بلاگ دسترسی داشته باشد، می‌توان دسترسی بلاگ داد.
- این کار مجاز است، به شرط رعایت قواعد امنیتی بخش 4.

## 4) مرزهای امنیتی غیرقابل عبور

موارد زیر فقط برای `Super Admin` مجاز است:
- مدیریت نقش‌ها و سیاست‌های دسترسی
- مدیریت ادمین‌ها در سطح امنیتی (ارتقا/تنزل سطح حساس)
- تنظیمات بحرانی سیستم و پنل
- عملیات امنیتی کلان

قیود قطعی:
- `Consultant` هرگز نباید `is_superuser=True` شود.
- `User` هرگز نباید به پنل ادمین وارد شود.
- اعتماد صرف به Role Picker فرانت ممنوع است.
- بک‌اند باید هر payload نامعتبر را رد کند (`400/403`).

## 5) قواعد پیاده‌سازی (Backend Enforcement)

1. اعتبارسنجی در Create/Update:
- هنگام ایجاد یا ویرایش کاربر/نقش، قوانین نقش باید چک شود.

2. اعتبارسنجی روی permission نهایی:
- فقط چک نام Role کافی نیست.
- اگر دسترسی‌ها به‌صورت `specific_permissions` ذخیره شوند، همان‌ها هم باید enforce شوند.

3. سوپرادمین‌سازی فقط توسط سوپرادمین:
- هر مسیر ارتقا به Super Admin باید صریح، کنترل‌شده و قابل ممیزی باشد.

4. ثبت رخداد (Audit):
- تغییر نقش، تغییر دسترسی، ارتقا/تنزل سطح دسترسی باید لاگ شود.

## 6) الگوی پیشنهادی برای سادگی مشتری

برای جلوگیری از پیچیدگی در پروژه‌های بزرگ:
- چند Role آماده داشته باشید (Template).
- فقط در صورت نیاز واقعی Role سفارشی بسازید.
- ماژول‌های حساس را خارج از دسترس نقش‌های عملیاتی نگه دارید.

نمونه Role Template:
- `Admin Full` (غیرسوپر)
- `Admin Content`
- `Consultant Standard`
- `Consultant + Blog`

## 7) چک‌لیست قبل از تحویل

1. کاربر معمولی:
- لاگین پنل ادمین ندارد.

2. Consultant:
- امکان سوپرادمین شدن ندارد.
- فقط دسترسی‌های تعریف‌شده خودش را دارد.

3. Admin:
- دسترسی‌ها طبق Role اعمال می‌شود.
- سوپرادمین شدن فقط از مسیر مجاز و توسط Super Admin انجام می‌شود.

4. Super Admin:
- دسترسی کامل فعال است.
- عملیات حساس فقط توسط همین نقش قابل اجراست.

5. تست نفوذ سطح دسترسی:
- ارسال دستی API با Role/Permission نامجاز باید رد شود.

---

این سیاست برای پروژه‌های حرفه‌ای و بزرگ مناسب است:  
ساده برای استفاده روزمره، ولی سخت‌گیر در نقاط امنیتی.
