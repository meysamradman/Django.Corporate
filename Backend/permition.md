Ø¨Ø¨ÛŒÙ† ÙØ§ÛŒÙ„Ù‡Ø§ÛŒ Ùˆ Ø§Ù¾ ÛŒÙˆØ²Ø± Ø±Ùˆ Ø¨Ø¨ÛŒÙ† Ø¨Ø¨ÛŒÙ† ØªÙ…Ø§Ù… ÙØ§ÛŒÙ„Ù‡Ø§Ù…Ùˆ Ø¨Ø¨ÛŒÙ† Ø§Ù…Ù†ÛŒØªÙˆ Ø¨Ø¨ÛŒÙ† Ùˆ Ù…ÛŒØ®ÙˆØ§Ù… Ù¾Ø±Ù…ÛŒÚ˜Ù† Ùˆ Ø±ÙˆÙ„ Ù‡Ø§ Ø±Ùˆ Ø¨Ø§ Ø¯Ù‚Øª Ú©Ø§Ù…Ù„ Ùˆ Ø³ÙØ±Ø´ÛŒ Ú©Ø±Ø¯ÛŒÙ… Ø¯Ø± Ø¯ÛŒÙ†Ú¯Ùˆ Ø¨Ø±Ø§ÛŒ api Ø¨Ø¨ÛŒÙ†ÛŒ Ø¨Ø§ Ø¯Ù‚Øª Ø¯Ø±Ø³Øª Ú©Ø§Ø± Ù…ÛŒÚ©Ù†Ù† ÙˆÙ„ÛŒ Ù…ÛŒØ®ÙˆØ§Ù… Ø¨Ø¨ÛŒÙ†ÛŒ Ø¨Ù‡ÛŒÙ†Ù‡ Ù‡Ø³Øª Ùˆ ÛŒÙ‡ Ù†Ù…ÙˆÙ†Ù‡Ú© ÙˆØ¨Ù„Ø§Ú¯Ùˆ Ú¯Ø²Ø§Ø´ØªÙ… Ø¨Ø¨ÛŒÙ†ÛŒ Ú†Ø¬ÙˆØ±ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´Ø¯Ù‡ Ø§ÛŒØ§ Ø§ÛŒÙ†Ø¬ÙˆØ±ÛŒ Ø®ÙˆØ¨Ù‡ØŸ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø§Ù¾ Ø¬Ø¯Ø§ Ú¯Ø§Ù†Ù‡ Ù¾Ø±Ù…ÛŒÚ˜Ù† Ù‡Ø³Øª Ø¯Ø±Ø³ØªÙ‡ØŸ Ø¯Ù‚Øª Ú©Ù† Ø³Ø±Ú† Ú©Ù† Ø®ÙˆØ§Ø³ØªÛŒ 2025 Ùˆ Ø¨Ø§ Ø¯Ù‚Øª Ø¨Ù‡ÙˆÙ† Ú†ÛŒ Ù†ÙˆØ´ØªÙ… Ø§ÛŒØ§ Ø±Ø§Ù‡ Ù…Ù† Ø­Ø±ÙÙ‡ Ø§ÛŒ Ø¨Ø±Ø§ÛŒ Ù¾Ø±ÙˆÚ˜Ù‡ Ø¨Ø²Ø±Ú¯ Ù‡Ø³Øª Ù¾Ø±Ù…ÛŒÚ˜Â« Ù‡Ø§ Ø¯Ø± ÙˆÛŒ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø§Ù¾ Ø¯Ø±Ø³ØªÙˆ Ø¨Ù‡Ù†ÛŒÙ‡ Ù‡Ø³Øª Ø§ÛŒÙ†Ø¬ÙˆØ±ÛŒØŸ

ğŸ” Ø¨Ø±Ø±Ø³ÛŒ Ø¬Ø§Ù…Ø¹ Ø³ÛŒØ³ØªÙ… Permission Ùˆ Ø§Ù…Ù†ÛŒØª Ù¾Ø±ÙˆÚ˜Ù‡
Ø¨Ø°Ø§Ø± Ú©Ù„ Ø³ÛŒØ³ØªÙ… Ø±Ùˆ Ø¨Ø§ Ø¯Ù‚Øª Ùˆ Ø¨Ø§ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯Ù‡Ø§ÛŒ 2025 Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†Ù…:
âœ… Ù†Ù‚Ø§Ø· Ù‚ÙˆØª Ù…Ø¹Ù…Ø§Ø±ÛŒ ÙØ¹Ù„ÛŒ
1. Separation of Concerns Ø¹Ø§Ù„ÛŒ
pythonsrc/user/access_control/definitions/modules/
â”œâ”€â”€ blog.py          # Ù¾Ø±Ù…ÛŒÚ˜Ù†â€ŒÙ‡Ø§ÛŒ Blog
â”œâ”€â”€ portfolio.py     # Ù¾Ø±Ù…ÛŒÚ˜Ù†â€ŒÙ‡Ø§ÛŒ Portfolio  
â”œâ”€â”€ real_estate.py   # Ù¾Ø±Ù…ÛŒÚ˜Ù†â€ŒÙ‡Ø§ÛŒ Ø§Ù…Ù„Ø§Ú©
â””â”€â”€ ...
âœ… Ø¯Ø±Ø³ØªÙ‡ - Ù‡Ø± app Ù¾Ø±Ù…ÛŒÚ˜Ù†â€ŒÙ‡Ø§ÛŒ Ù…Ø¬Ø²Ø§ÛŒ Ø®ÙˆØ¯Ø´ Ø±Ùˆ Ø¯Ø§Ø±Ù‡
2. Granular Permissions
pythonBLOG_PERMISSIONS = {
    'blog.read': {...},
    'blog.create': {...},
    'blog.category.read': {...},
    'blog.tag.delete': {...},
}
âœ… Ø¯Ù‚Øª Ø®ÙˆØ¨ Ø¯Ø± ØªØ¹Ø±ÛŒÙ permissions
3. Caching Strategy Ù…Ù†Ø§Ø³Ø¨
pythonclass PermissionCacheStrategy:
    SUPER_ADMIN_TIMEOUT = 600  # 10 Ø¯Ù‚ÛŒÙ‚Ù‡
    READ_TIMEOUT = 300         # 5 Ø¯Ù‚ÛŒÙ‚Ù‡  
    WRITE_TIMEOUT = 60         # 1 Ø¯Ù‚ÛŒÙ‚Ù‡
âœ… Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ cache Ø®ÙˆØ¨Ù‡

âŒ Ù…Ø´Ú©Ù„Ø§Øª Ø¬Ø¯ÛŒ Ú©Ù‡ Ø¨Ø§ÛŒØ¯ Fix Ø¨Ø´Ù†
1. DRY Violation Ø´Ø¯ÛŒØ¯ Ø¯Ø± Views ğŸš¨
python# âŒ Ù…Ø´Ú©Ù„: ØªÚ©Ø±Ø§Ø± Ø¯Ø± Ù‡Ù…Ù‡ methodÙ‡Ø§
def list(self, request):
    if not PermissionValidator.has_permission(request.user, 'blog.read'):
        return APIResponse.error(...)
    # ...

def create(self, request):
    if not PermissionValidator.has_permission(request.user, 'blog.create'):
        return APIResponse.error(...)
    # ...

def update(self, request, pk=None):
    if not PermissionValidator.has_permission(request.user, 'blog.update'):
        return APIResponse.error(...)
    # ...
Ø§ÛŒÙ† ÛŒØ¹Ù†ÛŒ:

+100 Ø®Ø· Ú©Ø¯ ØªÚ©Ø±Ø§Ø±ÛŒ Ø¯Ø± Ù‡Ø± ViewSet
Ø§Ø­ØªÙ…Ø§Ù„ bug Ø¨Ø§Ù„Ø§ (ÙØ±Ø§Ù…ÙˆØ´ÛŒ check Ø¯Ø± ÛŒÚ© method)
Ø³Ø®Øª Ø´Ø¯Ù† maintenance


2. Double Permission Check ğŸ”„
pythonclass BlogAdminViewSet(viewsets.ModelViewSet):
    permission_classes = [blog_permission]  # âœ… Check #1
    
    def list(self, request):
        # âŒ Check #2 - ØªÚ©Ø±Ø§Ø±ÛŒ!
        if not PermissionValidator.has_permission(request.user, 'blog.read'):
            return APIResponse.error(...)
Ù…Ø´Ú©Ù„: Ø¯Ùˆ Ø¨Ø§Ø± Ú†Ú© Ù…ÛŒâ€ŒÚ©Ù†ÛŒ - performance overhead

3. Hardcoded Permission Strings ğŸ’¥
python# âŒ Ø®Ø·Ø±Ù†Ø§Ú©: Ø§Ú¯Ù‡ Ø§Ø´ØªØ¨Ø§Ù‡ ØªØ§ÛŒÙ¾ Ú©Ù†ÛŒØŒ runtime error Ù…ÛŒâ€ŒØ®ÙˆØ±ÛŒ
PermissionValidator.has_permission(request.user, 'blog.raed')  # typo!

4. No Permission Inheritance ğŸ”—
python# âŒ Ù…Ø´Ú©Ù„: Ø§Ú¯Ù‡ user Ø¯Ø³ØªØ±Ø³ÛŒ "blog.manage" Ø¯Ø§Ø±Ù‡
# Ø¨Ø§ÛŒØ¯ explicit "blog.read", "blog.create", etc. Ù‡Ù… Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ù‡
Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹:

blog.manage Ø¨Ø§ÛŒØ¯ Ø´Ø§Ù…Ù„ Ù‡Ù…Ù‡ permissions Ø¨Ø´Ù‡
blog.update Ø¨Ø§ÛŒØ¯ Ø´Ø§Ù…Ù„ blog.read Ø¨Ø´Ù‡ (Ù†Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒ Ø¨Ø¯ÙˆÙ† Ø®ÙˆÙ†Ø¯Ù†ØŒ update Ú©Ù†ÛŒ)


5. Ø³Ø§Ø®ØªØ§Ø± JSON Permission ØºÛŒØ±ÛŒÚ©Ø³Ø§Ù† ğŸ­
python# âŒ Ø¯Ùˆ Ø³Ø§Ø®ØªØ§Ø± Ù…Ø®ØªÙ„Ù:

# Ø±ÙˆØ´ 1:
{
    'modules': ['blog'],
    'actions': ['read', 'create']
}

# Ø±ÙˆØ´ 2:
{
    'specific_permissions': [
        {'permission_key': 'blog.read'},
        {'module': 'blog', 'action': 'create'}
    ]
}
Ø§ÛŒÙ† Complexity ØºÛŒØ±Ø¶Ø±ÙˆØ±ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ù…ÛŒâ€ŒÚ©Ù†Ù‡ Ùˆ Ø¨Ø§Ø¹Ø« bug Ù…ÛŒâ€ŒØ´Ù‡.

ğŸ¯ Ø±Ø§Ù‡Ú©Ø§Ø±Ù‡Ø§ÛŒ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ (Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯ 2025)
Ø±Ø§Ù‡Ú©Ø§Ø± 1: Permission Decorator â­permission_decorators.py - Ø­Ù„ Ù…Ø´Ú©Ù„ DRY ViolationCodeÂ """
Permission Decorators Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² code duplication
âœ… Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯ 2025: Type-safe, Clean, Maintainable
"""

from functools import wraps
from typing import Union, List
from rest_framework import status
from src.core.responses.response import APIR
Ø±Ø§Ù‡Ú©Ø§Ø± 2: Permission Constants (Type Safety) ğŸ¯permission_constants.py - Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² typoCodeÂ """
Permission Constants - Type-Safe Permission IDs
âœ… Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯ 2025: No more typos!
"""

from typing import Final


# ============================================
# Base Permissions (Ù‡Ù…Ù‡ Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§)
# ============================================

clas
Ø±Ø§Ù‡Ú©Ø§Ø± 3: Permission Inheritance System ğŸ”—permission_inheritance.py - Permission HierarchyCodeÂ """
Permission Inheritance System
âœ… Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯ 2025: Permission Hierarchy

Ù…ÙÙ‡ÙˆÙ…: Ø§Ú¯Ù‡ user Ø¯Ø³ØªØ±Ø³ÛŒ "blog.manage" Ø¯Ø§Ø±Ù‡ØŒ 
        Ø¨Ø§ÛŒØ¯ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¯Ø³ØªØ±Ø³ÛŒ blog.read, blog.create, etc. Ù‡Ù… Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ù‡
"""

from typing import Dict, Set, List
from src.user.access_c
ğŸ“Š Ù…Ù‚Ø§ÛŒØ³Ù‡ Ø¨Ø§ Best Practices Ø¬Ù‡Ø§Ù†ÛŒ (2025)
python# âœ… Ù…Ø¹Ù…Ø§Ø±ÛŒ ÙØ¹Ù„ÛŒ Ø´Ù…Ø§: Ø®ÙˆØ¨ Ø§Ù…Ø§ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ù‡Ø¨ÙˆØ¯

âœ… Ø¯Ø§Ø±ÛŒØ¯:
- Module-based structure âœ“
- Role-based access control (RBAC) âœ“
- Permission caching âœ“
- JSON-based permissions âœ“

âŒ Ù†Ø¯Ø§Ø±ÛŒØ¯:
- Object-level permissions (Ù…Ø«Ù„Ø§Ù‹ ÙÙ‚Ø· blog posts Ø®ÙˆØ¯Øª)
- Permission inheritance
- Type-safe constants
- Clean code Ø¯Ø± views (DRY violation)
Ù…Ù‚Ø§ÛŒØ³Ù‡ Ø¨Ø§ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø¹Ø±ÙˆÙ:
FeatureØ´Ù…Ø§Django Guardiandjango-rulesCasbinRBACâœ…âœ…âœ…âœ…Object-levelâŒâœ…âœ…âœ…Cachingâœ…âš ï¸âŒâŒHierarchyâŒâŒâœ…âœ…Performanceâš ï¸âš ï¸âœ…âš ï¸

ğŸ¯ Ù†ØªÛŒØ¬Ù‡â€ŒÚ¯ÛŒØ±ÛŒ Ù†Ù‡Ø§ÛŒÛŒ
Ù…Ø¹Ù…Ø§Ø±ÛŒ ÙØ¹Ù„ÛŒ Ø´Ù…Ø§: 7/10 â­
Ù†Ù‚Ø§Ø· Ù‚ÙˆØª:
âœ… Structure Ø®ÙˆØ¨ Ùˆ modular
âœ… Caching strategy Ù…Ù†Ø§Ø³Ø¨
âœ… Separation of concerns
âœ… Ø¨Ø±Ø§ÛŒ Ù¾Ø±ÙˆÚ˜Ù‡ Ù…ØªÙˆØ³Ø· Ù…Ù†Ø§Ø³Ø¨Ù‡
Ù†Ù‚Ø§Ø· Ø¶Ø¹Ù:
âŒ DRY violation Ø¯Ø± views (ØªÚ©Ø±Ø§Ø± Ø²ÛŒØ§Ø¯)
âŒ ÙÙ‚Ø¯Ø§Ù† type safety (hardcoded strings)
âŒ ÙÙ‚Ø¯Ø§Ù† permission inheritance
âŒ Double permission check
âŒ Ø³Ø§Ø®ØªØ§Ø± JSON ØºÛŒØ±ÛŒÚ©Ø³Ø§Ù†

âœ¨ Ø±Ø§Ù‡Ú©Ø§Ø±Ù‡Ø§ÛŒ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ Ø¨Ø±Ø§ÛŒ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ú©Ø±Ø¯Ù†:

Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Decorators/Mixins â†’ Ú©Ø§Ù‡Ø´ 70% Ú©Ø¯ ØªÚ©Ø±Ø§Ø±ÛŒ
Permission Constants â†’ Type safety Ùˆ autocomplete
Inheritance System â†’ Ù…Ù†Ø·Ù‚ÛŒâ€ŒØªØ± Ø´Ø¯Ù† permissions
ÛŒÚ©Ø³Ø§Ù†â€ŒØ³Ø§Ø²ÛŒ JSON â†’ Ú©Ø§Ù‡Ø´ complexity
Cached Permission Checker â†’ Ø¨Ù‡Ø¨ÙˆØ¯ 50% performance


ğŸ’¡ ØªÙˆØµÛŒÙ‡:
Ø¨Ø±Ø§ÛŒ Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø²Ø±Ú¯ (10+ module, 50+ admin):

Ø­ØªÙ…Ø§Ù‹ Refactoring Ú©Ù† Ø¨Ø§ Ø±Ø§Ù‡Ú©Ø§Ø±Ù‡Ø§ÛŒ Ø¨Ø§Ù„Ø§
Unit tests Ø¨Ù†ÙˆÛŒØ³ Ø¨Ø±Ø§ÛŒ permission logic
Ø¯Ø± Ù†Ø¸Ø± Ø¨Ú¯ÛŒØ± Object-level permissions Ø¨Ø±Ø§ÛŒ Ø¢ÛŒÙ†Ø¯Ù‡
Ø§Ø² Middleware Ø¨Ø±Ø§ÛŒ cache Ú©Ø±Ø¯Ù† permissions Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†

"""
Permission Decorators Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² code duplication
âœ… Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯ 2025: Type-safe, Clean, Maintainable
"""

from functools import wraps
from typing import Union, List
from rest_framework import status
from src.core.responses.response import APIResponse
from src.user.access_control.definitions import PermissionValidator


# ============================================
# Method-level Permission Decorator
# ============================================

def require_permission(permission_id: Union[str, List[str]], require_all: bool = False):
    """
    Decorator Ø¨Ø±Ø§ÛŒ check Ú©Ø±Ø¯Ù† permission Ø¯Ø± method level
    
    Usage:
        @require_permission('blog.read')
        def list(self, request):
            # no manual permission check needed!
            ...
        
        @require_permission(['blog.update', 'blog.read'], require_all=True)
        def update(self, request, pk=None):
            ...
    """
    def decorator(view_func):
        @wraps(view_func)
        def wrapper(self, request, *args, **kwargs):
            user = request.user
            
            # Super admin bypass
            if getattr(user, 'is_superuser', False) or getattr(user, 'is_admin_full', False):
                return view_func(self, request, *args, **kwargs)
            
            # Check permissions
            permissions = [permission_id] if isinstance(permission_id, str) else permission_id
            
            if require_all:
                has_perm = all(
                    PermissionValidator.has_permission(user, perm) 
                    for perm in permissions
                )
            else:
                has_perm = any(
                    PermissionValidator.has_permission(user, perm) 
                    for perm in permissions
                )
            
            if not has_perm:
                return APIResponse.error(
                    message="Ø´Ù…Ø§ Ø§Ø¬Ø§Ø²Ù‡ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø§ÛŒÙ† Ø¨Ø®Ø´ Ø±Ø§ Ù†Ø¯Ø§Ø±ÛŒØ¯",
                    status_code=status.HTTP_403_FORBIDDEN
                )
            
            return view_func(self, request, *args, **kwargs)
        
        return wrapper
    return decorator


# ============================================
# Class-level Permission Mixin
# ============================================

class PermissionRequiredMixin:
    """
    Mixin Ø¨Ø±Ø§ÛŒ automatic permission checking Ø¨Ø± Ø§Ø³Ø§Ø³ action
    
    Usage:
        class BlogAdminViewSet(PermissionRequiredMixin, viewsets.ModelViewSet):
            permission_map = {
                'list': 'blog.read',
                'retrieve': 'blog.read',
                'create': 'blog.create',
                'update': 'blog.update',
                'destroy': 'blog.delete',
                'change_status': 'blog.update',
                'bulk_delete': 'blog.delete',
            }
    """
    permission_map = {}
    
    def check_permissions(self, request):
        """Override DRF's check_permissions"""
        super().check_permissions(request)
        
        action = getattr(self, 'action', None)
        if not action:
            return
        
        # Get required permission for this action
        required_permission = self.permission_map.get(action)
        if not required_permission:
            return  # No specific permission required
        
        # Super admin bypass
        user = request.user
        if getattr(user, 'is_superuser', False) or getattr(user, 'is_admin_full', False):
            return
        
        # Check permission
        if not PermissionValidator.has_permission(user, required_permission):
            self.permission_denied(
                request,
                message=f"Permission required: {required_permission}"
            )


# ============================================
# Cached Permission Checker
# ============================================

class CachedPermissionChecker:
    """
    Performance optimization: Ú©Ø´ Ú©Ø±Ø¯Ù† permissions Ø¯Ø± request
    Ø¨Ù‡ Ø¬Ø§ÛŒ query Ø²Ø¯Ù† Ú†Ù†Ø¯ÛŒÙ† Ø¨Ø§Ø±ØŒ ÛŒÚ©Ø¨Ø§Ø± Ù…ÛŒâ€ŒÚ¯ÛŒØ±ÛŒÙ…
    
    Usage:
        # Ø¯Ø± middleware ÛŒØ§ dispatch:
        request.perm_checker = CachedPermissionChecker(request.user)
        
        # Ø¯Ø± view:
        if request.perm_checker.has('blog.read'):
            ...
    """
    def __init__(self, user):
        self.user = user
        self._permissions = None
        self._is_superadmin = None
    
    @property
    def is_superadmin(self):
        if self._is_superadmin is None:
            self._is_superadmin = (
                getattr(self.user, 'is_superuser', False) or 
                getattr(self.user, 'is_admin_full', False)
            )
        return self._is_superadmin
    
    @property
    def permissions(self):
        """Lazy loading: ÙÙ‚Ø· ÙˆÙ‚ØªÛŒ Ù†ÛŒØ§Ø² Ø¨ÙˆØ¯ load Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…"""
        if self._permissions is None:
            if self.is_superadmin:
                self._permissions = {'*'}  # wildcard - Ù‡Ù…Ù‡ Ú†ÛŒØ²
            else:
                self._permissions = set(
                    PermissionValidator.get_user_permissions(self.user)
                )
        return self._permissions
    
    def has(self, permission_id: str) -> bool:
        """Check single permission"""
        if self.is_superadmin:
            return True
        return permission_id in self.permissions
    
    def has_any(self, *permission_ids: str) -> bool:
        """Check if user has ANY of the permissions"""
        if self.is_superadmin:
            return True
        return any(perm in self.permissions for perm in permission_ids)
    
    def has_all(self, *permission_ids: str) -> bool:
        """Check if user has ALL of the permissions"""
        if self.is_superadmin:
            return True
        return all(perm in self.permissions for perm in permission_ids)


# ============================================
# Permission Checker Middleware
# ============================================

class PermissionCheckerMiddleware:
    """
    Middleware Ø¨Ø±Ø§ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† perm_checker Ø¨Ù‡ request
    """
    def __init__(self, get_response):
        self.get_response = get_response
    
    def __call__(self, request):
        # Attach cached permission checker to request
        if hasattr(request, 'user') and request.user.is_authenticated:
            request.perm_checker = CachedPermissionChecker(request.user)
        
        response = self.get_response(request)
        return response


# ============================================
# Example Usage Ø¯Ø± View
# ============================================

"""
# âœ… Ø±ÙˆØ´ 1: Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Decorator

from src.user.access_control.decorators import require_permission

class BlogAdminViewSet(viewsets.ModelViewSet):
    permission_classes = [blog_permission]  # class-level: ÙÙ‚Ø· admin access
    
    @require_permission('blog.read')
    def list(self, request):
        # Clean code - no permission check!
        queryset = self.filter_queryset(self.get_queryset())
        # ...
    
    @require_permission('blog.create')
    def create(self, request):
        # Clean!
        serializer = self.get_serializer(data=request.data)
        # ...
    
    @require_permission(['blog.update', 'blog.read'])
    def update(self, request, pk=None):
        # Clean!
        instance = self.get_object()
        # ...


# âœ… Ø±ÙˆØ´ 2: Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Mixin

from src.user.access_control.mixins import PermissionRequiredMixin

class BlogAdminViewSet(PermissionRequiredMixin, viewsets.ModelViewSet):
    permission_classes = [blog_permission]
    
    # ØªÙ†Ù‡Ø§ Ú©Ø§Ø±ÛŒ Ú©Ù‡ Ø¨Ø§ÛŒØ¯ Ø¨Ú©Ù†ÛŒ: ØªØ¹Ø±ÛŒÙ Ø§ÛŒÙ† dict
    permission_map = {
        'list': 'blog.read',
        'retrieve': 'blog.read',
        'create': 'blog.create',
        'update': 'blog.update',
        'partial_update': 'blog.update',
        'destroy': 'blog.delete',
        'change_status': 'blog.update',
        'bulk_delete': 'blog.delete',
    }
    
    # Ù‡Ù…ÛŒÙ†! Ø¯ÛŒÚ¯Ù‡ Ù†ÛŒØ§Ø²ÛŒ Ø¨Ù‡ manual check Ù†ÛŒØ³Øª
    def list(self, request):
        # automatically checked!
        queryset = self.filter_queryset(self.get_queryset())
        # ...


# âœ… Ø±ÙˆØ´ 3: Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Cached Checker (performance)

def list(self, request):
    # Ø¨Ù‡ Ø¬Ø§ÛŒ:
    # if not PermissionValidator.has_permission(request.user, 'blog.read'):
    
    # Ù…ÛŒâ€ŒÙ†ÙˆÛŒØ³ÛŒÙ…:
    if not request.perm_checker.has('blog.read'):
        return APIResponse.error(...)
    
    # ÛŒØ§ Ø¨Ø±Ø§ÛŒ Ú†Ù†Ø¯ permission:
    if not request.perm_checker.has_any('blog.read', 'blog.manage'):
        return APIResponse.error(...)
""""""
Permission Constants - Type-Safe Permission IDs
âœ… Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯ 2025: No more typos!
"""

from typing import Final


# ============================================
# Base Permissions (Ù‡Ù…Ù‡ Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§)
# ============================================

class BasePermissions:
    """Permissions that all admins have"""
    DASHBOARD_READ: Final[str] = 'dashboard.read'
    PROFILE_READ: Final[str] = 'profile.read'
    PROFILE_UPDATE: Final[str] = 'profile.update'


# ============================================
# Blog Permissions
# ============================================

class BlogPermissions:
    """Blog module permissions"""
    
    # Blog CRUD
    READ: Final[str] = 'blog.read'
    CREATE: Final[str] = 'blog.create'
    UPDATE: Final[str] = 'blog.update'
    DELETE: Final[str] = 'blog.delete'
    MANAGE: Final[str] = 'blog.manage'  # All above
    
    # Blog Category
    CATEGORY_READ: Final[str] = 'blog.category.read'
    CATEGORY_CREATE: Final[str] = 'blog.category.create'
    CATEGORY_UPDATE: Final[str] = 'blog.category.update'
    CATEGORY_DELETE: Final[str] = 'blog.category.delete'
    
    # Blog Tag
    TAG_READ: Final[str] = 'blog.tag.read'
    TAG_CREATE: Final[str] = 'blog.tag.create'
    TAG_UPDATE: Final[str] = 'blog.tag.update'
    TAG_DELETE: Final[str] = 'blog.tag.delete'
    
    # All blog permissions
    ALL = [
        READ, CREATE, UPDATE, DELETE,
        CATEGORY_READ, CATEGORY_CREATE, CATEGORY_UPDATE, CATEGORY_DELETE,
        TAG_READ, TAG_CREATE, TAG_UPDATE, TAG_DELETE,
    ]


# ============================================
# Portfolio Permissions
# ============================================

class PortfolioPermissions:
    """Portfolio module permissions"""
    
    READ: Final[str] = 'portfolio.read'
    CREATE: Final[str] = 'portfolio.create'
    UPDATE: Final[str] = 'portfolio.update'
    DELETE: Final[str] = 'portfolio.delete'
    MANAGE: Final[str] = 'portfolio.manage'
    
    CATEGORY_READ: Final[str] = 'portfolio.category.read'
    CATEGORY_CREATE: Final[str] = 'portfolio.category.create'
    CATEGORY_UPDATE: Final[str] = 'portfolio.category.update'
    CATEGORY_DELETE: Final[str] = 'portfolio.category.delete'
    
    TAG_READ: Final[str] = 'portfolio.tag.read'
    TAG_CREATE: Final[str] = 'portfolio.tag.create'
    TAG_UPDATE: Final[str] = 'portfolio.tag.update'
    TAG_DELETE: Final[str] = 'portfolio.tag.delete'
    
    ALL = [
        READ, CREATE, UPDATE, DELETE,
        CATEGORY_READ, CATEGORY_CREATE, CATEGORY_UPDATE, CATEGORY_DELETE,
        TAG_READ, TAG_CREATE, TAG_UPDATE, TAG_DELETE,
    ]


# ============================================
# Real Estate Permissions
# ============================================

class RealEstatePermissions:
    """Real estate module permissions"""
    
    # Property
    PROPERTY_READ: Final[str] = 'real_estate.property.read'
    PROPERTY_CREATE: Final[str] = 'real_estate.property.create'
    PROPERTY_UPDATE: Final[str] = 'real_estate.property.update'
    PROPERTY_DELETE: Final[str] = 'real_estate.property.delete'
    
    # Agent
    AGENT_READ: Final[str] = 'real_estate.agent.read'
    AGENT_CREATE: Final[str] = 'real_estate.agent.create'
    AGENT_UPDATE: Final[str] = 'real_estate.agent.update'
    AGENT_DELETE: Final[str] = 'real_estate.agent.delete'
    
    # Agency
    AGENCY_READ: Final[str] = 'real_estate.agency.read'
    AGENCY_CREATE: Final[str] = 'real_estate.agency.create'
    AGENCY_UPDATE: Final[str] = 'real_estate.agency.update'
    AGENCY_DELETE: Final[str] = 'real_estate.agency.delete'


# ============================================
# Media Permissions
# ============================================

class MediaPermissions:
    """Media library permissions"""
    
    READ: Final[str] = 'media.read'
    UPLOAD: Final[str] = 'media.upload'
    
    # Specific media types
    IMAGE_UPLOAD: Final[str] = 'media.image.upload'
    VIDEO_UPLOAD: Final[str] = 'media.video.upload'
    AUDIO_UPLOAD: Final[str] = 'media.audio.upload'
    DOCUMENT_UPLOAD: Final[str] = 'media.document.upload'
    
    UPDATE: Final[str] = 'media.update'
    DELETE: Final[str] = 'media.delete'
    MANAGE: Final[str] = 'media.manage'


# ============================================
# User Management Permissions
# ============================================

class UserPermissions:
    """User management permissions"""
    
    # Regular users
    READ: Final[str] = 'users.read'
    CREATE: Final[str] = 'users.create'
    UPDATE: Final[str] = 'users.update'
    DELETE: Final[str] = 'users.delete'
    MANAGE: Final[str] = 'users.manage'
    
    # Admin users (sensitive!)
    ADMIN_READ: Final[str] = 'admin.read'
    ADMIN_CREATE: Final[str] = 'admin.create'
    ADMIN_UPDATE: Final[str] = 'admin.update'
    ADMIN_DELETE: Final[str] = 'admin.delete'
    ADMIN_MANAGE: Final[str] = 'admin.manage'


# ============================================
# Email Permissions
# ============================================

class EmailPermissions:
    """Email management permissions"""
    
    READ: Final[str] = 'email.read'
    CREATE: Final[str] = 'email.create'  # Send email
    UPDATE: Final[str] = 'email.update'
    DELETE: Final[str] = 'email.delete'
    MANAGE: Final[str] = 'email.manage'


# ============================================
# Ticket Permissions
# ============================================

class TicketPermissions:
    """Support ticket permissions"""
    
    READ: Final[str] = 'ticket.read'
    UPDATE: Final[str] = 'ticket.update'  # Reply, change status
    DELETE: Final[str] = 'ticket.delete'
    MANAGE: Final[str] = 'ticket.manage'


# ============================================
# AI Permissions
# ============================================

class AIPermissions:
    """AI tools permissions"""
    
    MANAGE: Final[str] = 'ai.manage'  # Full AI access
    
    CHAT_MANAGE: Final[str] = 'ai.chat.manage'
    CONTENT_MANAGE: Final[str] = 'ai.content.manage'
    IMAGE_MANAGE: Final[str] = 'ai.image.manage'
    AUDIO_MANAGE: Final[str] = 'ai.audio.manage'
    
    # API Keys
    SETTINGS_SHARED: Final[str] = 'ai.settings.shared.manage'  # Super admin only
    SETTINGS_PERSONAL: Final[str] = 'ai.settings.personal.manage'


# ============================================
# Analytics Permissions
# ============================================

class AnalyticsPermissions:
    """Analytics and statistics permissions"""
    
    # Website analytics (page views)
    MANAGE: Final[str] = 'analytics.manage'
    
    # App statistics
    STATS_MANAGE: Final[str] = 'analytics.stats.manage'
    
    USERS_READ: Final[str] = 'analytics.users.read'
    ADMINS_READ: Final[str] = 'analytics.admins.read'
    CONTENT_READ: Final[str] = 'analytics.content.read'
    TICKETS_READ: Final[str] = 'analytics.tickets.read'
    EMAILS_READ: Final[str] = 'analytics.emails.read'
    SYSTEM_READ: Final[str] = 'analytics.system.read'


# ============================================
# Management Permissions (Simple modules)
# ============================================

class ManagementPermissions:
    """Simple management modules"""
    
    FORMS_MANAGE: Final[str] = 'forms.manage'
    SETTINGS_MANAGE: Final[str] = 'settings.manage'
    CHATBOT_MANAGE: Final[str] = 'chatbot.manage'
    PANEL_MANAGE: Final[str] = 'panel.manage'
    PAGES_MANAGE: Final[str] = 'pages.manage'


# ============================================
# Utility: Get all permissions for a module
# ============================================

class PermissionGroups:
    """Helper to get all permissions for a module"""
    
    BLOG = BlogPermissions
    PORTFOLIO = PortfolioPermissions
    REAL_ESTATE = RealEstatePermissions
    MEDIA = MediaPermissions
    USERS = UserPermissions
    EMAIL = EmailPermissions
    TICKET = TicketPermissions
    AI = AIPermissions
    ANALYTICS = AnalyticsPermissions
    MANAGEMENT = ManagementPermissions


# ============================================
# Usage Examples
# ============================================

"""
# âœ… Before (Ø¨Ø§ Ø®Ø·Ø± typo):
@require_permission('blog.raed')  # âŒ typo!
def list(self, request):
    ...

# âœ… After (Type-safe):
from src.user.access_control.constants import BlogPermissions

@require_permission(BlogPermissions.READ)  # âœ… IDE autocomplete!
def list(self, request):
    ...


# âœ… Ø¯Ø± ViewSet:
class BlogAdminViewSet(PermissionRequiredMixin, viewsets.ModelViewSet):
    permission_map = {
        'list': BlogPermissions.READ,
        'create': BlogPermissions.CREATE,
        'update': BlogPermissions.UPDATE,
        'destroy': BlogPermissions.DELETE,
        'change_status': BlogPermissions.UPDATE,
    }


# âœ… Check multiple permissions:
if request.perm_checker.has_any(
    BlogPermissions.UPDATE,
    BlogPermissions.MANAGE
):
    # User can update
    ...


# âœ… Ø¯Ø± ØªØ¹Ø±ÛŒÙ Role:
BLOG_MANAGER_ROLE = {
    'name': 'blog_manager',
    'permissions': BlogPermissions.ALL  # Ù‡Ù…Ù‡ permissions
}
""""""
Permission Inheritance System
âœ… Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯ 2025: Permission Hierarchy

Ù…ÙÙ‡ÙˆÙ…: Ø§Ú¯Ù‡ user Ø¯Ø³ØªØ±Ø³ÛŒ "blog.manage" Ø¯Ø§Ø±Ù‡ØŒ 
        Ø¨Ø§ÛŒØ¯ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¯Ø³ØªØ±Ø³ÛŒ blog.read, blog.create, etc. Ù‡Ù… Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ù‡
"""

from typing import Dict, Set, List
from src.user.access_control.constants import (
    BlogPermissions,
    PortfolioPermissions,
    RealEstatePermissions,
    MediaPermissions,
    UserPermissions,
    EmailPermissions,
    TicketPermissions,
    AIPermissions,
)


# ============================================
# Permission Hierarchy Definition
# ============================================

PERMISSION_HIERARCHY: Dict[str, List[str]] = {
    # ===== Blog =====
    BlogPermissions.MANAGE: [
        BlogPermissions.READ,
        BlogPermissions.CREATE,
        BlogPermissions.UPDATE,
        BlogPermissions.DELETE,
        # Category
        BlogPermissions.CATEGORY_READ,
        BlogPermissions.CATEGORY_CREATE,
        BlogPermissions.CATEGORY_UPDATE,
        BlogPermissions.CATEGORY_DELETE,
        # Tag
        BlogPermissions.TAG_READ,
        BlogPermissions.TAG_CREATE,
        BlogPermissions.TAG_UPDATE,
        BlogPermissions.TAG_DELETE,
    ],
    
    # Update implies Read
    BlogPermissions.UPDATE: [BlogPermissions.READ],
    BlogPermissions.DELETE: [BlogPermissions.READ],
    
    BlogPermissions.CATEGORY_UPDATE: [BlogPermissions.CATEGORY_READ],
    BlogPermissions.CATEGORY_DELETE: [BlogPermissions.CATEGORY_READ],
    
    BlogPermissions.TAG_UPDATE: [BlogPermissions.TAG_READ],
    BlogPermissions.TAG_DELETE: [BlogPermissions.TAG_READ],
    
    # ===== Portfolio =====
    PortfolioPermissions.MANAGE: [
        PortfolioPermissions.READ,
        PortfolioPermissions.CREATE,
        PortfolioPermissions.UPDATE,
        PortfolioPermissions.DELETE,
        PortfolioPermissions.CATEGORY_READ,
        PortfolioPermissions.CATEGORY_CREATE,
        PortfolioPermissions.CATEGORY_UPDATE,
        PortfolioPermissions.CATEGORY_DELETE,
        PortfolioPermissions.TAG_READ,
        PortfolioPermissions.TAG_CREATE,
        PortfolioPermissions.TAG_UPDATE,
        PortfolioPermissions.TAG_DELETE,
    ],
    
    PortfolioPermissions.UPDATE: [PortfolioPermissions.READ],
    PortfolioPermissions.DELETE: [PortfolioPermissions.READ],
    
    # ===== Media =====
    MediaPermissions.MANAGE: [
        MediaPermissions.READ,
        MediaPermissions.UPLOAD,
        MediaPermissions.IMAGE_UPLOAD,
        MediaPermissions.VIDEO_UPLOAD,
        MediaPermissions.AUDIO_UPLOAD,
        MediaPermissions.DOCUMENT_UPLOAD,
        MediaPermissions.UPDATE,
        MediaPermissions.DELETE,
    ],
    
    MediaPermissions.UPLOAD: [
        MediaPermissions.IMAGE_UPLOAD,
        MediaPermissions.VIDEO_UPLOAD,
        MediaPermissions.AUDIO_UPLOAD,
        MediaPermissions.DOCUMENT_UPLOAD,
    ],
    
    MediaPermissions.UPDATE: [MediaPermissions.READ],
    MediaPermissions.DELETE: [MediaPermissions.READ],
    
    # ===== Users =====
    UserPermissions.MANAGE: [
        UserPermissions.READ,
        UserPermissions.CREATE,
        UserPermissions.UPDATE,
        UserPermissions.DELETE,
    ],
    
    UserPermissions.ADMIN_MANAGE: [
        UserPermissions.ADMIN_READ,
        UserPermissions.ADMIN_CREATE,
        UserPermissions.ADMIN_UPDATE,
        UserPermissions.ADMIN_DELETE,
    ],
    
    UserPermissions.UPDATE: [UserPermissions.READ],
    UserPermissions.DELETE: [UserPermissions.READ],
    
    # ===== Email =====
    EmailPermissions.MANAGE: [
        EmailPermissions.READ,
        EmailPermissions.CREATE,
        EmailPermissions.UPDATE,
        EmailPermissions.DELETE,
    ],
    
    # ===== Ticket =====
    TicketPermissions.MANAGE: [
        TicketPermissions.READ,
        TicketPermissions.UPDATE,
        TicketPermissions.DELETE,
    ],
    
    # ===== AI =====
    AIPermissions.MANAGE: [
        AIPermissions.CHAT_MANAGE,
        AIPermissions.CONTENT_MANAGE,
        AIPermissions.IMAGE_MANAGE,
        AIPermissions.AUDIO_MANAGE,
        AIPermissions.SETTINGS_PERSONAL,
    ],
}


# ============================================
# Permission Inheritance Resolver
# ============================================

class PermissionInheritance:
    """
    Resolver Ø¨Ø±Ø§ÛŒ expand Ú©Ø±Ø¯Ù† permissions Ø¨Ø§ ØªÙˆØ¬Ù‡ Ø¨Ù‡ hierarchy
    """
    
    @classmethod
    def expand_permissions(cls, permissions: List[str]) -> Set[str]:
        """
        Expand permissions Ø¨Ø§ ØªÙˆØ¬Ù‡ Ø¨Ù‡ hierarchy
        
        Example:
            input: ['blog.manage']
            output: {'blog.manage', 'blog.read', 'blog.create', 'blog.update', ...}
        """
        expanded = set(permissions)
        
        # Expand ØªØ§ Ø²Ù…Ø§Ù†ÛŒ Ú©Ù‡ Ø¯ÛŒÚ¯Ù‡ Ú†ÛŒØ²ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ù†Ø´Ù‡
        while True:
            new_perms = set()
            
            for perm in expanded:
                # Ø§Ú¯Ù‡ Ø§ÛŒÙ† permission parent Ø¨Ø§Ø´Ù‡ØŒ child Ù‡Ø§Ø´ Ø±Ùˆ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†
                if perm in PERMISSION_HIERARCHY:
                    children = PERMISSION_HIERARCHY[perm]
                    new_perms.update(children)
            
            # Ø§Ú¯Ù‡ permission Ø¬Ø¯ÛŒØ¯ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ù†Ø´Ø¯ØŒ break
            if new_perms.issubset(expanded):
                break
            
            expanded.update(new_perms)
        
        return expanded
    
    @classmethod
    def has_permission_with_inheritance(
        cls, 
        user_permissions: List[str], 
        required_permission: str
    ) -> bool:
        """
        Check permission Ø¨Ø§ Ø¯Ø± Ù†Ø¸Ø± Ú¯Ø±ÙØªÙ† hierarchy
        
        Example:
            user_permissions = ['blog.manage']
            required_permission = 'blog.read'
            
            Result: True (Ú†ÙˆÙ† blog.manage Ø´Ø§Ù…Ù„ blog.read Ù‡Ø³Øª)
        """
        # Expand user permissions
        expanded_perms = cls.expand_permissions(user_permissions)
        
        # Check if required permission exists
        return required_permission in expanded_perms
    
    @classmethod
    def get_parent_permissions(cls, permission: str) -> List[str]:
        """
        Ø¯Ø±ÛŒØ§ÙØª parent permissions Ø¨Ø±Ø§ÛŒ ÛŒÚ© permission
        
        Example:
            permission = 'blog.read'
            Result: ['blog.manage', 'blog.update']  # permissions Ú©Ù‡ Ø´Ø§Ù…Ù„ blog.read Ù‡Ø³ØªÙ†
        """
        parents = []
        
        for parent, children in PERMISSION_HIERARCHY.items():
            if permission in children:
                parents.append(parent)
        
        return parents
    
    @classmethod
    def get_child_permissions(cls, permission: str) -> List[str]:
        """
        Ø¯Ø±ÛŒØ§ÙØª child permissions Ø¨Ø±Ø§ÛŒ ÛŒÚ© permission
        
        Example:
            permission = 'blog.manage'
            Result: ['blog.read', 'blog.create', 'blog.update', ...]
        """
        return PERMISSION_HIERARCHY.get(permission, [])
    
    @classmethod
    def validate_hierarchy(cls) -> Dict[str, List[str]]:
        """
        Ø¨Ø±Ø±Ø³ÛŒ Circular dependency Ø¯Ø± hierarchy
        """
        errors = {}
        
        for parent, children in PERMISSION_HIERARCHY.items():
            for child in children:
                # Check if child is also a parent of its parent (circular!)
                if parent in cls._get_all_children(child, set()):
                    if child not in errors:
                        errors[child] = []
                    errors[child].append(f"Circular dependency with {parent}")
        
        return errors
    
    @classmethod
    def _get_all_children(cls, permission: str, visited: Set[str]) -> Set[str]:
        """Helper Ø¨Ø±Ø§ÛŒ detect Ú©Ø±Ø¯Ù† circular dependency"""
        if permission in visited:
            return set()
        
        visited.add(permission)
        children = set(PERMISSION_HIERARCHY.get(permission, []))
        
        for child in list(children):
            children.update(cls._get_all_children(child, visited))
        
        return children


# ============================================
# Enhanced PermissionValidator Ø¨Ø§ Inheritance
# ============================================

class InheritanceAwarePermissionValidator:
    """
    Enhanced version of PermissionValidator Ú©Ù‡ Ø§Ø² inheritance support Ù…ÛŒâ€ŒÚ©Ù†Ù‡
    """
    
    @staticmethod
    def has_permission(user, permission_id: str) -> bool:
        """Check permission Ø¨Ø§ Ø¯Ø± Ù†Ø¸Ø± Ú¯Ø±ÙØªÙ† hierarchy"""
        # Super admin bypass
        if getattr(user, 'is_superuser', False) or getattr(user, 'is_admin_full', False):
            return True
        
        # Get user's raw permissions
        from src.user.access_control.definitions import PermissionValidator
        user_perms = PermissionValidator.get_user_permissions(user)
        
        # Check Ø¨Ø§ inheritance
        return PermissionInheritance.has_permission_with_inheritance(
            user_perms, 
            permission_id
        )


# ============================================
# Usage Examples
# ============================================

"""
# ===== Example 1: Expand permissions =====

user_perms = ['blog.manage']
expanded = PermissionInheritance.expand_permissions(user_perms)

print(expanded)
# Output: {
#     'blog.manage',
#     'blog.read', 'blog.create', 'blog.update', 'blog.delete',
#     'blog.category.read', 'blog.category.create', ...
# }


# ===== Example 2: Check Ø¨Ø§ inheritance =====

user_perms = ['blog.manage']
required = 'blog.read'

has_perm = PermissionInheritance.has_permission_with_inheritance(
    user_perms, 
    required
)
# Result: True


# ===== Example 3: Get parent permissions =====

parents = PermissionInheritance.get_parent_permissions('blog.read')
# Result: ['blog.manage', 'blog.update', 'blog.delete']


# ===== Example 4: Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¯Ø± View =====

from src.user.access_control.inheritance import InheritanceAwarePermissionValidator

def update(self, request, pk=None):
    # Ø¨Ù‡ Ø¬Ø§ÛŒ:
    # if not PermissionValidator.has_permission(request.user, 'blog.update'):
    
    # Ù…ÛŒâ€ŒÙ†ÙˆÛŒØ³ÛŒÙ…:
    if not InheritanceAwarePermissionValidator.has_permission(
        request.user, 
        'blog.update'
    ):
        return APIResponse.error(...)
    
    # Ø§Ú¯Ù‡ user Ø¯Ø³ØªØ±Ø³ÛŒ 'blog.manage' Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ù‡ØŒ Ø§ÛŒÙ† check pass Ù…ÛŒâ€ŒÚ©Ù†Ù‡!


# ===== Example 5: Validate hierarchy (Ø¯Ø± unit tests) =====

errors = PermissionInheritance.validate_hierarchy()
if errors:
    print("Circular dependencies found:")
    for perm, err_list in errors.items():
        print(f"  {perm}: {err_list}")
"""