#!/usr/bin/env python
"""
ุงุณฺฉุฑูพุช ฺฉุงูู ุจุฑุง import ฺฉุฑุฏู ุดูุฑูุง ู ุงุณุชุงูโูุง ุงุฑุงู
ูพุดุชุจุงู ุงุฒ ูุฑ ุฏู app: user ู real_estate

๐ ููุทู ฺฉุงุฑ:
  - ุงุฒ get_or_create ุงุณุชูุงุฏู ูโฺฉูุฏ ุชุง duplicate ุงุฌุงุฏ ูุดูุฏ
  - ุงฺฏุฑ ููุฌูุฏ ุจูุฏุ update ูโฺฉูุฏ (ูุงูุ ูุถุนุช)
  - ุงฺฏุฑ ููุฌูุฏ ูุจูุฏุ create ูโฺฉูุฏ
  - ูฺ ุฏุงุฏูโุง ูพุงฺฉ ููโุดูุฏ - ููุท ุงุถุงูู ู ุจูโุฑูุฒุฑุณุงู ูโุดูุฏ

โ๏ธ  ููู: ุจู ุตูุฑุช ูพุดโูุฑุถ ููุท real_estate import ูโุดูุฏ ุชุง ุงุฒ duplicate ุฏุฑ User ุฌููฺฏุฑ ุดูุฏ

ุงุฌุฑุง: 
  - ููุท Real Estate (ูพุดโูุฑุถ): python scripts/import_iranian_locations.py
  - ููุท User: python scripts/import_iranian_locations.py --app user
  - ูุฑ ุฏู: python scripts/import_iranian_locations.py --app both
"""

import os
import sys
import argparse

# ุชูุธู encoding ุจุฑุง Windows
if sys.platform == 'win32':
    import io
    sys.stdout = io.TextIOWrapper(sys.stdout.buffer, encoding='utf-8')
    sys.stderr = io.TextIOWrapper(sys.stderr.buffer, encoding='utf-8')

# ุงุถุงูู ฺฉุฑุฏู ูุณุฑ ูพุฑูฺู ุจู sys.path
sys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

# ุชูุธู Django settings
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'config.django.base')

try:
    import django
    from django.db import transaction
    django.setup()
    from src.user.models.location import Province as UserProvince, City as UserCity
    from src.real_estate.models.location import (
        Country, Province as RealEstateProvince, City as RealEstateCity
    )
except ImportError as e:
    print(f"โ ุฎุทุง ุฏุฑ import Django: {e}")
    print("ูุทูุฆู ุดูุฏ ฺฉู Django ูุตุจ ุดุฏู ู ูุณุฑ ุฏุฑุณุช ุงุณุช")
    sys.exit(1)

# ุฏุงุฏูโูุง ฺฉุงูู ุงุณุชุงูโูุง ู ุดูุฑูุง ุงุฑุงู (31 ุงุณุชุงู)
# ููุทูู ู ูุญูู ุจู ุตูุฑุช ุฏุงูุงูฺฉ ุงุฒ ุทุฑู ููุดู ุฏุฑ ูพูู ุงุฏูู ุงุฌุงุฏ ูโุดููุฏ
PROVINCES_DATA = [
    {"name": "ุขุฐุฑุจุงุฌุงู ุดุฑู", "code": "01", "cities": [
        "ุชุจุฑุฒ", "ูุฑุงุบู", "ูุงูู", "ุดุจุณุชุฑ", "ูุฑูุฏ", "ุจูุงุจ", "ุงุณฺฉู", "ุดุงููโุฏฺ", 
        "ูุดุชุฑูุฏ", "ุจุณุชุงูโุขุจุงุฏ", "ุณุฑุงุจ", "ูุฑุณ", "ุนุฌุจโุดุฑ", "ฺฉูุจุฑ", "ุฌููุง", "ุงูุฑ"
    ]},
    {"name": "ุขุฐุฑุจุงุฌุงู ุบุฑุจ", "code": "02", "cities": [
        "ุงุฑููู", "ุฎู", "ููุงุจุงุฏ", "ุจูฺฉุงู", "ูุงูุฏูุขุจ", "ุณููุงุณ", "ูพุฑุงูุดูุฑ", 
        "ููุฏู", "ุดุงููโุฏฺ", "ุชฺฉุงุจ", "ูุงฺฉู", "ุณุฑุฏุดุช", "ุงุดููู", "ฺุงูุฏุฑุงู", "ุจุงูู"
    ]},
    {"name": "ุงุฑุฏุจู", "code": "03", "cities": [
        "ุงุฑุฏุจู", "ูพุงุฑุณโุขุจุงุฏ", "ุฎูุฎุงู", "ูุดฺฏูโุดูุฑ", "ฺฉูุซุฑ", "ฺฏุฑู", "ููู", 
        "ูุฑ", "ุณุฑุนู", "ุงุตูุงูุฏูุฒ", "ูุฑ", "ูุฎุฑุขุจุงุฏ"
    ]},
    {"name": "ุงุตููุงู", "code": "04", "cities": [
        "ุงุตููุงู", "ฺฉุงุดุงู", "ุฎููโุดูุฑ", "ูุฌูโุขุจุงุฏ", "ุดุงููโุดูุฑ", "ูููุงุฏุดูุฑ", 
        "ูุจุงุฑฺฉู", "ููุงูุฑุฌุงู", "ูุทูุฒ", "ุงุฑุฏุณุชุงู", "ูุงู", "ฺฏููพุงฺฏุงู", "ุฎูุงูุณุงุฑ", 
        "ุณูุฑู", "ุฏูุงูุงู", "ุดุงููโุดูุฑ ู ููู", "ุชุฑุงู ู ฺฉุฑูู", "ุจุฑุฎูุงุฑ ู ููู"
    ]},
    {"name": "ุงูุจุฑุฒ", "code": "05", "cities": [
        "ฺฉุฑุฌ", "ูุฑุฏุณ", "ูุธุฑุขุจุงุฏ", "ูุดุชฺฏุฑุฏ", "ุณุงูุฌุจูุงุบ", "ุทุงููุงู", "ุงุดุชูุงุฑุฏ", 
        "ูุงูุฏุดุช", "ฺฏูุณุชุงู", "ูุญูุฏุดูุฑ", "ูุดฺฉูโุฏุดุช", "ูุฑุฏุณ", "ูุงูุฏุดุช"
    ]},
    {"name": "ุงูุงู", "code": "06", "cities": [
        "ุงูุงู", "ุฏููุฑุงู", "ุขุจุฏุงูุงู", "ุฏุฑูโุดูุฑ", "ุงูุงู", "ููุฑุงู", "ุดุฑูุงู ฺุฑุฏุงูู", 
        "ููฺฉุดุงู", "ุจุฏุฑู", "ุขุณูุงูโุขุจุงุฏ", "ุฏููุฑุงู"
    ]},
    {"name": "ุจูุดูุฑ", "code": "07", "cities": [
        "ุจูุดูุฑ", "ุจุฑุงุฒุฌุงู", "ฺฏูุงูู", "ุฎูุฑููุฌ", "ุฌู", "ุฏุฑ", "ฺฉูฺฏุงู", "ุนุณููู", 
        "ุฏุดุช", "ุชูฺฏุณุชุงู", "ุฌู", "ุฏุฑ", "ฺฉูฺฏุงู"
    ]},
    {"name": "ุชูุฑุงู", "code": "08", "cities": [
        "ุชูุฑุงู", "ูุฑุงูู", "ุฑุจุงุทโฺฉุฑู", "ุดูุฑุงุฑ", "ุงุณูุงูโุดูุฑ", "ูพุงฺฉุฏุดุช", "ูุฏุณ", 
        "ููุงุฑุฏ", "ุจูุงุฑุณุชุงู", "ูพุดูุง", "ูุฑฺฺฉ", "ุฑ", "ุดูุฑุงูุงุช", "ุฏูุงููุฏ", 
        "ูุฑูุฒฺฉูู", "ูุฑุงูู", "ูพุงฺฉุฏุดุช", "ูุฑฺฺฉ", "ุจูุงุฑุณุชุงู", "ููุงุฑุฏ", "ูุฏุณ"
    ]},
    {"name": "ฺูุงุฑูุญุงู ู ุจุฎุชุงุฑ", "code": "09", "cities": [
        "ุดูุฑฺฉุฑุฏ", "ุจุฑูุฌู", "ูุงุฑุณุงู", "ูุฑุฏฺฏุงู", "ุงุฑุฏู", "ุณุงูุงู", "ฺฏูุฏูุงู", "ูุงุฑุณุงู", 
        "ูุฑุฏฺฏุงู", "ุงุฑุฏู", "ุณุงูุงู", "ฺฏูุฏูุงู", "ูุงุฑุณุงู"
    ]},
    {"name": "ุฎุฑุงุณุงู ุฌููุจ", "code": "10", "cities": [
        "ุจุฑุฌูุฏ", "ูุงุฆู", "ูุฑุฏูุณ", "ุทุจุณ", "ููุจูุฏุงู", "ุฏุฑูุงู", "ุณุฑุงุงู", "ุณุฑุจุดู", 
        "ุฎูุณู", "ุฒุฑฺฉูู", "ุทุจุณ", "ูุฑุฏูุณ", "ูุงุฆู"
    ]},
    {"name": "ุฎุฑุงุณุงู ุฑุถู", "code": "11", "cities": [
        "ูุดูุฏ", "ูุดุงุจูุฑ", "ุณุจุฒูุงุฑ", "ฺฉุงุดูุฑ", "ุชุฑุจุช ุญุฏุฑู", "ููฺุงู", "ุชุงุจุงุฏ", 
        "ุฎูุงู", "ุชุฑุจุช ุฌุงู", "ฺูุงุฑุงู", "ุฏุฑฺฏุฒ", "ูุฑูุงู", "ฺฏูุงุจุงุฏ", "ุฎููโุขุจุงุฏ", 
        "ุจุฑุฏุณฺฉู", "ุฌุบุชุง", "ุฏุงูุฑุฒู", "ูุฑูุฒู", "ฺฉูุงุช", "ูุดูุฏ", "ูุดุงุจูุฑ", "ุณุจุฒูุงุฑ"
    ]},
    {"name": "ุฎุฑุงุณุงู ุดูุงู", "code": "12", "cities": [
        "ุจุฌููุฑุฏ", "ุขุดุฎุงูู", "ุงุณูุฑุงู", "ุดุฑูุงู", "ูุงุฑูุฌ", "ฺฏุฑูู", "ุฌุงุฌุฑู", "ุฑุงุฒ", 
        "ุดุฑูุงู", "ูุงุฑูุฌ", "ฺฏุฑูู", "ุฌุงุฌุฑู", "ุฑุงุฒ", "ุจุฌููุฑุฏ", "ุขุดุฎุงูู", "ุงุณูุฑุงู"
    ]},
    {"name": "ุฎูุฒุณุชุงู", "code": "13", "cities": [
        "ุงููุงุฒ", "ุขุจุงุฏุงู", "ุฎุฑูุดูุฑ", "ุฏุฒููู", "ุจูุจูุงู", "ุงูุฏูุดฺฉ", "ูุงูุดูุฑ", 
        "ุดุงุฏฺฏุงู", "ุฑุงููุฑูุฒ", "ุดูุด", "ุดูุดุชุฑ", "ฺฏุชููุฏ", "ูุงู", "ููุฏุฌุงู", "ุจูุฏุฑ ูุงูุดูุฑ", 
        "ุขุจุงุฏุงู", "ุฎุฑูุดูุฑ", "ุฏุฒููู", "ุจูุจูุงู", "ุงูุฏูุดฺฉ"
    ]},
    {"name": "ุฒูุฌุงู", "code": "14", "cities": [
        "ุฒูุฌุงู", "ุงุจูุฑ", "ุฎุฑูุฏุฑู", "ุทุงุฑู", "ูุงููุดุงู", "ูุฏุงุฑ", "ุฎุฏุงุจูุฏู", "ุงุฌุฑูุฏ", 
        "ูุงููุดุงู", "ุทุงุฑู", "ุฎุฑูุฏุฑู", "ุงุจูุฑ", "ุฒูุฌุงู"
    ]},
    {"name": "ุณููุงู", "code": "15", "cities": [
        "ุณููุงู", "ุดุงูุฑูุฏ", "ุฏุงูุบุงู", "ฺฏุฑูุณุงุฑ", "ุขุฑุงุฏุงู", "ุจุณุทุงู", "ุดุงูุฑูุฏ", "ุฏุงูุบุงู", 
        "ฺฏุฑูุณุงุฑ", "ุขุฑุงุฏุงู", "ุจุณุทุงู", "ุณููุงู"
    ]},
    {"name": "ุณุณุชุงู ู ุจููฺุณุชุงู", "code": "16", "cities": [
        "ุฒุงูุฏุงู", "ฺุงุจูุงุฑ", "ุฒุงุจู", "ุงุฑุงูุดูุฑ", "ุณุฑุงูุงู", "ุฎุงุด", "ุฑุงุณฺฉ", "ุณุฑุจุงุฒ", 
        "ฺฉูุงุฑฺฉ", "ูฺฉโุดูุฑ", "ูุตุฑููุฏ", "ุฒุงูุฏุงู", "ฺุงุจูุงุฑ", "ุฒุงุจู", "ุงุฑุงูุดูุฑ", "ุณุฑุงูุงู"
    ]},
    {"name": "ูุงุฑุณ", "code": "17", "cities": [
        "ุดุฑุงุฒ", "ฺฉุงุฒุฑูู", "ูุฑูุฏุดุช", "ุฌูุฑู", "ูุงุฑุณุชุงู", "ูุณุง", "ุฏุงุฑุงุจ", "ุงุณุชูุจุงู", 
        "ูโุฑุฒ", "ุงููุฏ", "ุขุจุงุฏู", "ุณูพุฏุงู", "ููุณู", "ฺฏุฑุงุด", "ูุงูุฑุฏ", "ูุฑุงุดุจูุฏ", 
        "ฺฉูุงุฑ", "ุฎุฑุงูู", "ุฒุฑูุงู", "ฺฉุงุฒุฑูู", "ูุฑูุฏุดุช", "ุฌูุฑู", "ูุงุฑุณุชุงู", "ูุณุง"
    ]},
    {"name": "ูุฒูู", "code": "18", "cities": [
        "ูุฒูู", "ุชุงฺฉุณุชุงู", "ุขุจฺฉ", "ุงูููุฏ", "ุจููโุฒูุฑุง", "ูุญููุฏุขุจุงุฏ", "ุขุจฺฉ", 
        "ุงูููุฏ", "ุจููโุฒูุฑุง", "ูุญููุฏุขุจุงุฏ", "ุชุงฺฉุณุชุงู", "ูุฒูู"
    ]},
    {"name": "ูู", "code": "19", "cities": [
        "ูู", "ุฌุนูุฑู", "ุณููฺฺฏุงู", "ฺฉูฺฉ", "ุณููฺฺฏุงู", "ฺฉูฺฉ", "ุฌุนูุฑู", "ูู"
    ]},
    {"name": "ฺฉุฑุฏุณุชุงู", "code": "20", "cities": [
        "ุณููุฏุฌ", "ุจุงูู", "ุณูุฒ", "ูุฑูุงู", "ุฏูุงูุฏุฑู", "ฺฉุงูุงุฑุงู", "ูุฑูู", "ุฏูฺฏูุงู", 
        "ุจุฌุงุฑ", "ฺฉุงูุงุฑุงู", "ูุฑูู", "ุฏูฺฏูุงู", "ุจุฌุงุฑ", "ุจุงูู", "ุณูุฒ", "ูุฑูุงู", "ุฏูุงูุฏุฑู"
    ]},
    {"name": "ฺฉุฑูุงู", "code": "21", "cities": [
        "ฺฉุฑูุงู", "ุฌุฑูุช", "ุฑูุณูุฌุงู", "ุฒุฑูุฏ", "ุณุฑุฌุงู", "ุจู", "ุจุฑุฏุณุฑ", "ุฑุงูุฑ", 
        "ุจุงูุช", "ุดูุฑ ุจุงุจฺฉ", "ุฑุงู", "ฺฉููุจูุงู", "ูููุฌุงู", "ฺฉูููุฌ", "ุนูุจุฑุขุจุงุฏ", 
        "ุฌุฑูุช", "ุฑูุณูุฌุงู", "ุฒุฑูุฏ", "ุณุฑุฌุงู", "ุจู"
    ]},
    {"name": "ฺฉุฑูุงูุดุงู", "code": "22", "cities": [
        "ฺฉุฑูุงูุดุงู", "ุงุณูุงูโุขุจุงุฏ ุบุฑุจ", "ฺฉูฺฏุงูุฑ", "ูุฑุณู", "ุณููุฑ", "ูพุงูู", "ุฌูุงูุฑูุฏ", 
        "ุฑูุงูุณุฑ", "ุซูุงุซ ุจุงุจุงุฌุงู", "ูุตุฑุดุฑู", "ฺฏูุงูุบุฑุจ", "ูุฑุณู", "ุณููุฑ", "ูพุงูู", 
        "ุฌูุงูุฑูุฏ", "ุฑูุงูุณุฑ", "ุซูุงุซ ุจุงุจุงุฌุงู", "ูุตุฑุดุฑู", "ฺฏูุงูุบุฑุจ", "ุงุณูุงูโุขุจุงุฏ ุบุฑุจ", "ฺฉูฺฏุงูุฑ"
    ]},
    {"name": "ฺฉูฺฏููู ู ุจูุฑุงุญูุฏ", "code": "23", "cities": [
        "ุงุณูุฌ", "ฺฏฺุณุงุฑุงู", "ุฏูฺฏูุจุฏุงู", "ุฏูุง", "ุจุงุดุช", "ฺุฑุงู", "ูฺฉฺฉ", "ุฏูุฏุดุช", 
        "ุฏูฺฏูุจุฏุงู", "ุฏูุง", "ุจุงุดุช", "ฺุฑุงู", "ูฺฉฺฉ", "ุฏูุฏุดุช", "ฺฏฺุณุงุฑุงู", "ุงุณูุฌ"
    ]},
    {"name": "ฺฏูุณุชุงู", "code": "24", "cities": [
        "ฺฏุฑฺฏุงู", "ฺฏูุจุฏ ฺฉุงููุณ", "ุนูโุขุจุงุฏ ฺฉุชูู", "ูููุฏุดุช", "ุขูโููุง", "ฺฉุฑุฏฺฉู", 
        "ุจูุฏุฑ ุชุฑฺฉูู", "ุจูุฏุฑ ฺฏุฒ", "ฺฉูุงูู", "ุขุฒุงุฏุดูุฑ", "ุฑุงูุงู", "ฺฏูุจุฏ ฺฉุงููุณ", 
        "ุนูโุขุจุงุฏ ฺฉุชูู", "ูููุฏุดุช", "ุขูโููุง", "ฺฉุฑุฏฺฉู"
    ]},
    {"name": "ฺฏูุงู", "code": "25", "cities": [
        "ุฑุดุช", "ุงูุฒู", "ูุงูุฌุงู", "ููฺฏุฑูุฏ", "ุฑูุฏุณุฑ", "ูููู", "ุตููุนูโุณุฑุง", "ุฑูุฏุจุงุฑ", 
        "ููุฌู", "ุงููุด", "ุชุงูุด", "ูุงุณุงู", "ุดูุช", "ุขุณุชุงุฑุง", "ุฑุถูุงูุดูุฑ", "ฺฉูููู", 
        "ูุงูุฌุงู", "ููฺฏุฑูุฏ", "ุฑูุฏุณุฑ", "ูููู", "ุตููุนูโุณุฑุง", "ุฑูุฏุจุงุฑ", "ููุฌู"
    ]},
    {"name": "ูุฑุณุชุงู", "code": "26", "cities": [
        "ุฎุฑูโุขุจุงุฏ", "ุจุฑูุฌุฑุฏ", "ุฏูุฑูุฏ", "ุงูฺฏูุฏุฑุฒ", "ฺฉููุฏุดุช", "ูพูโุฏุฎุชุฑ", "ุงุฒูุง", 
        "ููุฑุขุจุงุฏ", "ูพูุฏุฎุชุฑ", "ุฑููุดฺฉุงู", "ุณูุณูู", "ุฏููุงู", "ุจุฑูุฌุฑุฏ", "ุฏูุฑูุฏ", 
        "ุงูฺฏูุฏุฑุฒ", "ฺฉููุฏุดุช", "ูพูโุฏุฎุชุฑ", "ุงุฒูุง", "ููุฑุขุจุงุฏ"
    ]},
    {"name": "ูุงุฒูุฏุฑุงู", "code": "27", "cities": [
        "ุณุงุฑ", "ุจุงุจู", "ุขูู", "ูุงุฆูโุดูุฑ", "ุจุงุจูุณุฑ", "ุจูุดูุฑ", "ููุดูุฑ", "ฺุงููุณ", 
        "ุฑุงูุณุฑ", "ุชูฺฉุงุจู", "ููุฑ", "ุขูู", "ูุงุฆูโุดูุฑ", "ุจุงุจูุณุฑ", "ุจูุดูุฑ", "ููุดูุฑ", 
        "ฺุงููุณ", "ุฑุงูุณุฑ", "ุชูฺฉุงุจู", "ููุฑ", "ุณุงุฑ", "ุจุงุจู"
    ]},
    {"name": "ูุฑฺฉุฒ", "code": "28", "cities": [
        "ุงุฑุงฺฉ", "ุณุงูู", "ุฎูู", "ูุญูุงุช", "ุฏูุฌุงู", "ุดุงุฒูุฏ", "ุขุดุชุงู", "ุชูุฑุด", 
        "ูุฑุงูุงู", "ฺฉูุฌุงู", "ุฎูุฏุงุจ", "ุณุงูู", "ุฎูู", "ูุญูุงุช", "ุฏูุฌุงู", "ุดุงุฒูุฏ", 
        "ุขุดุชุงู", "ุชูุฑุด", "ูุฑุงูุงู", "ฺฉูุฌุงู", "ุฎูุฏุงุจ", "ุงุฑุงฺฉ"
    ]},
    {"name": "ูุฑูุฒฺฏุงู", "code": "29", "cities": [
        "ุจูุฏุฑุนุจุงุณ", "ูุดู", "ฺฉุด", "ููุงุจ", "ุจูุฏุฑ ููฺฏู", "ุจูุฏุฑ ุฌุงุณฺฉ", "ุญุงุฌโุขุจุงุฏ", 
        "ุฑูุฏุงู", "ูุดู", "ฺฉุด", "ููุงุจ", "ุจูุฏุฑ ููฺฏู", "ุจูุฏุฑ ุฌุงุณฺฉ", "ุญุงุฌโุขุจุงุฏ", 
        "ุฑูุฏุงู", "ุจูุฏุฑุนุจุงุณ"
    ]},
    {"name": "ููุฏุงู", "code": "30", "cities": [
        "ููุฏุงู", "ููุงุฑ", "ููุงููุฏ", "ฺฉุจูุฏุฑุขููฺฏ", "ุชูุณุฑฺฉุงู", "ุงุณุฏุขุจุงุฏ", "ุจูุงุฑ", 
        "ุฑุฒู", "ูุงููู", "ููุงุฑ", "ููุงููุฏ", "ฺฉุจูุฏุฑุขููฺฏ", "ุชูุณุฑฺฉุงู", "ุงุณุฏุขุจุงุฏ", 
        "ุจูุงุฑ", "ุฑุฒู", "ูุงููู", "ููุฏุงู"
    ]},
    {"name": "ุฒุฏ", "code": "31", "cities": [
        "ุฒุฏ", "ูุจุฏ", "ุงุฑุฏฺฉุงู", "ุจุงูู", "ุงุจุฑฺฉูู", "ููุฑุฒ", "ุชูุช", "ุงุจุฑฺฉูู", 
        "ุจุงูู", "ุงุฑุฏฺฉุงู", "ูุจุฏ", "ููุฑุฒ", "ุชูุช", "ุฒุฏ"
    ]}
]


def import_user_locations(update_mode=True):
    """Import locations for user app 
    
    ููุทู:
    - ุงุฒ get_or_create ุงุณุชูุงุฏู ูโฺฉูุฏ ุชุง duplicate ุงุฌุงุฏ ูุดูุฏ
    - ุงฺฏุฑ ููุฌูุฏ ุจูุฏุ update ูโฺฉูุฏ (ูุงูุ ูุถุนุช)
    - ุงฺฏุฑ ููุฌูุฏ ูุจูุฏุ create ูโฺฉูุฏ
    - ูฺ ุฏุงุฏูโุง ูพุงฺฉ ููโุดูุฏ (ุญุช ุจุฏูู update_mode)
    """
    print("\n" + "="*60)
    print("๐ Import ุจุฑุง User Location")
    print("="*60)
    print("๐ ููุทู: ุฌููฺฏุฑ ุงุฒ duplicate + update ููุงุฑุฏ ููุฌูุฏ + ุงุถุงูู ฺฉุฑุฏู ููุงุฑุฏ ุฌุฏุฏ")
    
    try:
        with transaction.atomic():
            total_provinces = len(PROVINCES_DATA)
            total_cities = sum(len(prov["cities"]) for prov in PROVINCES_DATA)
            
            print(f"๐ ุขูุงุฏู import {total_provinces} ุงุณุชุงู ู {total_cities} ุดูุฑ...")
            
            province_count = 0
            city_count = 0
            
            for province_data in PROVINCES_DATA:
                # ุงุฌุงุฏ ุง ุจูโุฑูุฒุฑุณุงู ุงุณุชุงู (ุฌููฺฏุฑ ุงุฒ duplicate)
                province, created = UserProvince.objects.get_or_create(
                    code=province_data["code"],
                    defaults={
                        "name": province_data["name"],
                        "is_active": True
                    }
                )
                
                # ุงฺฏุฑ ููุฌูุฏ ุจูุฏุ update ฺฉู (ุจุฑุง ุจูโุฑูุฒุฑุณุงู ูุงู ุง ูุถุนุช)
                if not created:
                    province.name = province_data["name"]
                    province.is_active = True
                    province.save()
                
                province_count += 1
                status = "ุงุฌุงุฏ ุดุฏ" if created else "ุจูโุฑูุฒุฑุณุงู ุดุฏ"
                print(f"โ ุงุณุชุงู '{province_data['name']}' ุจุง ฺฉุฏ {province_data['code']} {status}")
                
                # ุงุฌุงุฏ ุง ุจูโุฑูุฒุฑุณุงู ุดูุฑูุง ุงุณุชุงู
                cities = province_data["cities"]
                cities_created = 0
                cities_updated = 0
                
                for index, city_name in enumerate(cities, 1):
                    city_code = f"{province_data['code']}{index:02d}"
                    city, created = UserCity.objects.get_or_create(
                        code=city_code,
                        province=province,
                        defaults={
                            "name": city_name,
                            "is_active": True
                        }
                    )
                    
                    # ุงฺฏุฑ ููุฌูุฏ ุจูุฏุ update ฺฉู
                    if not created:
                        city.name = city_name
                        city.is_active = True
                        city.save()
                        cities_updated += 1
                    else:
                        cities_created += 1
                    
                    city_count += 1
                
                print(f"   ๐ {len(cities)} ุดูุฑ: {cities_created} ุงุฌุงุฏ ุดุฏุ {cities_updated} ุจูโุฑูุฒุฑุณุงู ุดุฏ")
            
            print(f"\n๐ import User Location ุจุง ููููุช ุงูุฌุงู ุดุฏ!")
            print(f"๐ ูุชุงุฌ ููุง:")
            print(f"   โข {province_count} ุงุณุชุงู")
            print(f"   โข {city_count} ุดูุฑ")
            
            return True
            
    except Exception as e:
        print(f"\nโ ุฎุทุง ุฏุฑ import User Location: {str(e)}")
        import traceback
        traceback.print_exc()
        return False


def import_real_estate_locations(update_mode=False):
    """Import locations for real_estate app
    
    ููุทู:
    - ุงุฒ get_or_create ุงุณุชูุงุฏู ูโฺฉูุฏ ุชุง duplicate ุงุฌุงุฏ ูุดูุฏ
    - ุงฺฏุฑ ููุฌูุฏ ุจูุฏุ update ูโฺฉูุฏ (ูุงูุ ูุถุนุช)
    - ุงฺฏุฑ ููุฌูุฏ ูุจูุฏุ create ูโฺฉูุฏ
    - ูฺ ุฏุงุฏูโุง ูพุงฺฉ ููโุดูุฏ (ุญุช ุจุฏูู update_mode)
    """
    print("\n" + "="*60)
    print("๐ Import ุจุฑุง Real Estate Location")
    print("="*60)
    print("๐ ููุทู: ุฌููฺฏุฑ ุงุฒ duplicate + update ููุงุฑุฏ ููุฌูุฏ + ุงุถุงูู ฺฉุฑุฏู ููุงุฑุฏ ุฌุฏุฏ")
    
    try:
        with transaction.atomic():
            # ุงุฌุงุฏ ุง ุฏุฑุงูุช ฺฉุดูุฑ ุงุฑุงู
            country, created = Country.objects.get_or_create(
                code='IRN',
                defaults={
                    'name': 'Iran',
                    'is_active': True
                }
            )
            
            # ุงฺฏุฑ ููุฌูุฏ ุจูุฏุ update ฺฉู
            if not created:
                country.name = 'Iran'
                country.is_active = True
                country.save()
            
            status_country = "ุงุฌุงุฏ ุดุฏ" if created else "ุจูโุฑูุฒุฑุณุงู ุดุฏ"
            print(f"๐ ฺฉุดูุฑ ุงุฑุงู {status_country}")
            
            total_provinces = len(PROVINCES_DATA)
            total_cities = sum(len(prov["cities"]) for prov in PROVINCES_DATA)
            
            print(f"๐ ุขูุงุฏู import {total_provinces} ุงุณุชุงู ู {total_cities} ุดูุฑ...")
            
            province_count = 0
            city_count = 0
            region_count = 0
            district_count = 0
            
            for province_data in PROVINCES_DATA:
                # ุงุฌุงุฏ ุง ุจูโุฑูุฒุฑุณุงู ุงุณุชุงู (ุฌููฺฏุฑ ุงุฒ duplicate)
                province, created = RealEstateProvince.objects.get_or_create(
                    code=province_data["code"],
                    defaults={
                        "name": province_data["name"],
                        "country": country,
                        "is_active": True
                    }
                )
                
                # ุงฺฏุฑ ููุฌูุฏ ุจูุฏุ update ฺฉู (ุจุฑุง ุจูโุฑูุฒุฑุณุงู ูุงู ุง ูุถุนุช)
                if not created:
                    province.name = province_data["name"]
                    province.country = country
                    province.is_active = True
                    province.save()
                
                province_count += 1
                status = "ุงุฌุงุฏ ุดุฏ" if created else "ุจูโุฑูุฒุฑุณุงู ุดุฏ"
                print(f"โ ุงุณุชุงู '{province_data['name']}' ุจุง ฺฉุฏ {province_data['code']} {status}")
                
                # ุงุฌุงุฏ ุง ุจูโุฑูุฒุฑุณุงู ุดูุฑูุง ุงุณุชุงู
                cities = province_data["cities"]
                cities_created = 0
                cities_updated = 0
                
                for index, city_name in enumerate(cities, 1):
                    city_code = f"{province_data['code']}{index:02d}"
                    city, created = RealEstateCity.objects.get_or_create(
                        code=city_code,
                        province=province,
                        defaults={
                            "name": city_name,
                            "is_active": True
                        }
                    )
                    
                    # ุงฺฏุฑ ููุฌูุฏ ุจูุฏุ update ฺฉู
                    if not created:
                        city.name = city_name
                        city.is_active = True
                        city.save()
                        cities_updated += 1
                    else:
                        cities_created += 1
                    
                    city_count += 1
                    
                    # ููุทูู ู ูุญูู ุจู ุตูุฑุช ุฏุงูุงูฺฉ ุงุฒ ุทุฑู ููุดู ุฏุฑ ูพูู ุงุฏูู ุงุฌุงุฏ ูโุดููุฏ
                    # ูฺ region/district ูพุดโูุฑุถ ุงุฌุงุฏ ููโุดูุฏ
                    # ฺฉุงุฑุจุฑุงู ุฏุฑ ูพูู ุงุฏูู ุจุง ุงูุชุฎุงุจ ุฑู ููุดูุ region ู district ุฑุง ุงุฌุงุฏ ูโฺฉููุฏ
                
                print(f"   ๐ {len(cities)} ุดูุฑ: {cities_created} ุงุฌุงุฏ ุดุฏุ {cities_updated} ุจูโุฑูุฒุฑุณุงู ุดุฏ")
                print(f"   โน๏ธ  ููุทูู ู ูุญูู ุจู ุตูุฑุช ุฏุงูุงูฺฉ ุงุฒ ุทุฑู ููุดู ุฏุฑ ูพูู ุงุฏูู ุงุฌุงุฏ ูโุดููุฏ")
            
            print(f"\n๐ import Real Estate Location ุจุง ููููุช ุงูุฌุงู ุดุฏ!")
            print(f"๐ ูุชุงุฌ ููุง:")
            print(f"   โข {province_count} ุงุณุชุงู")
            print(f"   โข {city_count} ุดูุฑ")
            print(f"   โน๏ธ  ููุทูู ู ูุญูู ุจู ุตูุฑุช ุฏุงูุงูฺฉ ุงุฒ ุทุฑู ููุดู ุฏุฑ ูพูู ุงุฏูู ุงุฌุงุฏ ูโุดููุฏ")
            
            return True
            
    except Exception as e:
        print(f"\nโ ุฎุทุง ุฏุฑ import Real Estate Location: {str(e)}")
        import traceback
        traceback.print_exc()
        return False


def main():
    """ุชุงุจุน ุงุตู"""
    parser = argparse.ArgumentParser(
        description='Import Iranian provinces and cities',
        formatter_class=argparse.RawDescriptionHelpFormatter,
        epilog="""
ูุซุงูโูุง:
  # ููุท Real Estate (ูพุดโูุฑุถ - ุจุฑุง ุฌููฺฏุฑ ุงุฒ duplicate ุฏุฑ User)
  python scripts/import_iranian_locations.py
  
  # ููุท Real Estate ุจุง update
  python scripts/import_iranian_locations.py --update
  
  # ููุท User (ุจุง update ุจุฑุง ุฌููฺฏุฑ ุงุฒ duplicate)
  python scripts/import_iranian_locations.py --app user --update
  
  # ูุฑ ุฏู (ุจุง update ุจุฑุง User)
  python scripts/import_iranian_locations.py --app both --update
        """
    )
    
    parser.add_argument(
        '--app',
        choices=['user', 'real_estate', 'both'],
        default='real_estate',
        help='ุงูุชุฎุงุจ app ุจุฑุง import (default: real_estate - ุจุฑุง ุฌููฺฏุฑ ุงุฒ duplicate ุฏุฑ User)'
    )
    
    parser.add_argument(
        '--update',
        action='store_true',
        help='(ุงุฎุชุงุฑ) ููุดู ุงุฒ get_or_create ุงุณุชูุงุฏู ูโุดูุฏ - ุงู flag ููุท ุจุฑุง ุณุงุฒฺฏุงุฑ ุงุณุช'
    )
    
    args = parser.parse_args()
    
    print("๐ ุดุฑูุน import ุฏุงุฏูโูุง ุงุณุชุงูโูุง ู ุดูุฑูุง ุงุฑุงู...")
    print(f"๐ฆ App ุงูุชุฎุงุจ ุดุฏู: {args.app}")
    print("๐ ููุทู: ุฌููฺฏุฑ ุงุฒ duplicate + update ููุงุฑุฏ ููุฌูุฏ + ุงุถุงูู ฺฉุฑุฏู ููุงุฑุฏ ุฌุฏุฏ")
    print("โน๏ธ  ูฺ ุฏุงุฏูโุง ูพุงฺฉ ููโุดูุฏ - ููุท ุงุถุงูู ู ุจูโุฑูุฒุฑุณุงู ูโุดูุฏ")
    
    success = True
    
    if args.app in ['user', 'both']:
        # ููุดู ุงุฒ get_or_create ุงุณุชูุงุฏู ูโฺฉูู (ุฌููฺฏุฑ ุงุฒ duplicate)
        if not import_user_locations(update_mode=True):
            success = False
    
    if args.app in ['real_estate', 'both']:
        # ููุดู ุงุฒ get_or_create ุงุณุชูุงุฏู ูโฺฉูู (ุฌููฺฏุฑ ุงุฒ duplicate)
        if not import_real_estate_locations(update_mode=True):
            success = False
    
    if success:
        print("\n" + "="*60)
        print("๐ฏ ููู importโูุง ุจุง ููููุช ุงูุฌุงู ุดุฏ!")
        print("="*60)
        
        # ููุงุด ุขูุงุฑ ููุง
        if args.app in ['user', 'both']:
            db_provinces = UserProvince.objects.count()
            db_cities = UserCity.objects.count()
            print(f"\n๐ User Location:")
            print(f"   โข ุงุณุชุงูโูุง: {db_provinces}")
            print(f"   โข ุดูุฑูุง: {db_cities}")
        
        if args.app in ['real_estate', 'both']:
            db_provinces = RealEstateProvince.objects.count()
            db_cities = RealEstateCity.objects.count()
            print(f"\n๐ Real Estate Location:")
            print(f"   โข ุงุณุชุงูโูุง: {db_provinces}")
            print(f"   โข ุดูุฑูุง: {db_cities}")
            print(f"   โน๏ธ  ููุทูู ู ูุญูู ุจู ุตูุฑุช ุฏุงูุงูฺฉ ุงุฒ ุทุฑู ููุดู ุฏุฑ ูพูู ุงุฏูู ุงุฌุงุฏ ูโุดููุฏ")
    else:
        print("\n" + "="*60)
        print("โ ุจุฑุฎ importโูุง ุจุง ุฎุทุง ููุงุฌู ุดุฏูุฏ!")
        print("="*60)
    
    return success


if __name__ == "__main__":
    success = main()
    if success:
        print("\n๐ ุงุณฺฉุฑูพุช ุจุง ููููุช ุงุฌุฑุง ุดุฏ!")
        exit(0)
    else:
        print("\n๐ฅ ุงุณฺฉุฑูพุช ุจุง ุฎุทุง ููุงุฌู ุดุฏ!")
        exit(1)
