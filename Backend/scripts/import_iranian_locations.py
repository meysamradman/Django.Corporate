#!/usr/bin/env python
"""
ุงุณฺฉุฑูพุช ฺฉุงูู ุจุฑุง import ฺฉุฑุฏู ุดูุฑูุง ู ุงุณุชุงูโูุง ุงุฑุงู
ุงุฌุฑุง: python scripts/import_iranian_locations.py
"""

import os
import sys

# ุงุถุงูู ฺฉุฑุฏู ูุณุฑ ูพุฑูฺู ุจู sys.path
sys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

# ุชูุธู Django settings
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'config.django.base')

try:
    import django
    from django.db import transaction
    django.setup()
    from src.user.models.location import Province, City
except ImportError as e:
    print(f"โ ุฎุทุง ุฏุฑ import Django: {e}")
    print("ูุทูุฆู ุดูุฏ ฺฉู Django ูุตุจ ุดุฏู ู ูุณุฑ ุฏุฑุณุช ุงุณุช")
    sys.exit(1)

def main():
    """ุชุงุจุน ุงุตู ุจุฑุง import ุฏุงุฏูโูุง ูฺฉุงู ุงุฑุงู"""
    
    print("๐ ุดุฑูุน import ุฏุงุฏูโูุง ุงุณุชุงูโูุง ู ุดูุฑูุง ุงุฑุงู...")
    
    # ุฏุงุฏูโูุง ุงุณุชุงูโูุง ุจุง ฺฉุฏูุง ู ุดูุฑูุง
    provinces_data = [
        {"name": "ุขุฐุฑุจุงุฌุงู ุดุฑู", "code": "01", "cities": ["ุชุจุฑุฒ", "ูุฑุงุบู", "ูุงูู", "ุดุจุณุชุฑ", "ูุฑูุฏ"]},
        {"name": "ุขุฐุฑุจุงุฌุงู ุบุฑุจ", "code": "02", "cities": ["ุงุฑููู", "ุฎู", "ููุงุจุงุฏ", "ุจูฺฉุงู", "ูุงูุฏูุขุจ"]},
        {"name": "ุงุฑุฏุจู", "code": "03", "cities": ["ุงุฑุฏุจู", "ูพุงุฑุณโุขุจุงุฏ", "ุฎูุฎุงู", "ูุดฺฏูโุดูุฑ", "ฺฉูุซุฑ"]},
        {"name": "ุงุตููุงู", "code": "04", "cities": ["ุงุตููุงู", "ฺฉุงุดุงู", "ุฎููโุดูุฑ", "ูุฌูโุขุจุงุฏ", "ุดุงููโุดูุฑ"]},
        {"name": "ุงูุจุฑุฒ", "code": "05", "cities": ["ฺฉุฑุฌ", "ูุฑุฏุณ", "ูุธุฑุขุจุงุฏ", "ูุดุชฺฏุฑุฏ", "ุณุงูุฌุจูุงุบ"]},
        {"name": "ุงูุงู", "code": "06", "cities": ["ุงูุงู", "ุฏููุฑุงู", "ุขุจุฏุงูุงู", "ุฏุฑูโุดูุฑ", "ุงูุงู"]},
        {"name": "ุจูุดูุฑ", "code": "07", "cities": ["ุจูุดูุฑ", "ุจุฑุงุฒุฌุงู", "ฺฏูุงูู", "ุฎูุฑููุฌ", "ุฌู"]},
        {"name": "ุชูุฑุงู", "code": "08", "cities": ["ุชูุฑุงู", "ูุฑุงูู", "ุฑุจุงุทโฺฉุฑู", "ุดูุฑุงุฑ", "ุงุณูุงูโุดูุฑ"]},
        {"name": "ฺูุงุฑูุญุงู ู ุจุฎุชุงุฑ", "code": "09", "cities": ["ุดูุฑฺฉุฑุฏ", "ุจุฑูุฌู", "ูุงุฑุณุงู", "ูุฑุฏฺฏุงู", "ุงุฑุฏู"]},
        {"name": "ุฎุฑุงุณุงู ุฌููุจ", "code": "10", "cities": ["ุจุฑุฌูุฏ", "ูุงุฆู", "ูุฑุฏูุณ", "ุทุจุณ", "ููุจูุฏุงู"]},
        {"name": "ุฎุฑุงุณุงู ุฑุถู", "code": "11", "cities": ["ูุดูุฏ", "ูุดุงุจูุฑ", "ุณุจุฒูุงุฑ", "ฺฉุงุดูุฑ", "ุชุฑุจุช ุญุฏุฑู"]},
        {"name": "ุฎุฑุงุณุงู ุดูุงู", "code": "12", "cities": ["ุจุฌููุฑุฏ", "ุขุดุฎุงูู", "ุงุณูุฑุงู", "ุดุฑูุงู", "ูุงุฑูุฌ"]},
        {"name": "ุฎูุฒุณุชุงู", "code": "13", "cities": ["ุงููุงุฒ", "ุขุจุงุฏุงู", "ุฎุฑูุดูุฑ", "ุฏุฒููู", "ุจูุจูุงู"]},
        {"name": "ุฒูุฌุงู", "code": "14", "cities": ["ุฒูุฌุงู", "ุงุจูุฑ", "ุฎุฑูุฏุฑู", "ุทุงุฑู", "ูุงููุดุงู"]},
        {"name": "ุณููุงู", "code": "15", "cities": ["ุณููุงู", "ุดุงูุฑูุฏ", "ุฏุงูุบุงู", "ฺฏุฑูุณุงุฑ", "ุขุฑุงุฏุงู"]},
        {"name": "ุณุณุชุงู ู ุจููฺุณุชุงู", "code": "16", "cities": ["ุฒุงูุฏุงู", "ฺุงุจูุงุฑ", "ุฒุงุจู", "ุงุฑุงูุดูุฑ", "ุณุฑุงูุงู"]},
        {"name": "ูุงุฑุณ", "code": "17", "cities": ["ุดุฑุงุฒ", "ฺฉุงุฒุฑูู", "ูุฑูุฏุดุช", "ุฌูุฑู", "ูุงุฑุณุชุงู"]},
        {"name": "ูุฒูู", "code": "18", "cities": ["ูุฒูู", "ุชุงฺฉุณุชุงู", "ุขุจฺฉ", "ุงูููุฏ", "ุจููโุฒูุฑุง"]},
        {"name": "ูู", "code": "19", "cities": ["ูู"]},
        {"name": "ฺฉุฑุฏุณุชุงู", "code": "20", "cities": ["ุณููุฏุฌ", "ุจุงูู", "ุณูุฒ", "ูุฑูุงู", "ุฏูุงูุฏุฑู"]},
        {"name": "ฺฉุฑูุงู", "code": "21", "cities": ["ฺฉุฑูุงู", "ุฌุฑูุช", "ุฑูุณูุฌุงู", "ุฒุฑูุฏ", "ุณุฑุฌุงู"]},
        {"name": "ฺฉุฑูุงูุดุงู", "code": "22", "cities": ["ฺฉุฑูุงูุดุงู", "ุงุณูุงูโุขุจุงุฏ ุบุฑุจ", "ฺฉูฺฏุงูุฑ", "ูุฑุณู", "ุณููุฑ"]},
        {"name": "ฺฉูฺฏููู ู ุจูุฑุงุญูุฏ", "code": "23", "cities": ["ุงุณูุฌ", "ฺฏฺุณุงุฑุงู", "ุฏูฺฏูุจุฏุงู", "ุฏูุง", "ุจุงุดุช"]},
        {"name": "ฺฏูุณุชุงู", "code": "24", "cities": ["ฺฏุฑฺฏุงู", "ฺฏูุจุฏ ฺฉุงููุณ", "ุนูโุขุจุงุฏ ฺฉุชูู", "ูููุฏุดุช", "ุขูโููุง"]},
        {"name": "ฺฏูุงู", "code": "25", "cities": ["ุฑุดุช", "ุงูุฒู", "ูุงูุฌุงู", "ููฺฏุฑูุฏ", "ุฑูุฏุณุฑ"]},
        {"name": "ูุฑุณุชุงู", "code": "26", "cities": ["ุฎุฑูโุขุจุงุฏ", "ุจุฑูุฌุฑุฏ", "ุฏูุฑูุฏ", "ุงูฺฏูุฏุฑุฒ", "ฺฉููุฏุดุช"]},
        {"name": "ูุงุฒูุฏุฑุงู", "code": "27", "cities": ["ุณุงุฑ", "ุจุงุจู", "ุขูู", "ูุงุฆูโุดูุฑ", "ุจุงุจูุณุฑ"]},
        {"name": "ูุฑฺฉุฒ", "code": "28", "cities": ["ุงุฑุงฺฉ", "ุณุงูู", "ุฎูู", "ูุญูุงุช", "ุฏูุฌุงู"]},
        {"name": "ูุฑูุฒฺฏุงู", "code": "29", "cities": ["ุจูุฏุฑุนุจุงุณ", "ูุดู", "ฺฉุด", "ููุงุจ", "ุจูุฏุฑ ููฺฏู"]},
        {"name": "ููุฏุงู", "code": "30", "cities": ["ููุฏุงู", "ููุงุฑ", "ููุงููุฏ", "ฺฉุจูุฏุฑุขููฺฏ", "ุชูุณุฑฺฉุงู"]},
        {"name": "ุฒุฏ", "code": "31", "cities": ["ุฒุฏ", "ูุจุฏ", "ุงุฑุฏฺฉุงู", "ุจุงูู", "ุงุจุฑฺฉูู"]}
    ]
    
    try:
        with transaction.atomic():
            print("๐๏ธ  ูพุงฺฉ ฺฉุฑุฏู ุฏุงุฏูโูุง ูุจู...")
            City.objects.all().delete()
            Province.objects.all().delete()
            
            total_provinces = len(provinces_data)
            total_cities = sum(len(prov["cities"]) for prov in provinces_data)
            
            print(f"๐ ุขูุงุฏู import {total_provinces} ุงุณุชุงู ู {total_cities} ุดูุฑ...")
            
            province_count = 0
            city_count = 0
            
            for province_data in provinces_data:
                # ุงุฌุงุฏ ุงุณุชุงู
                province = Province.objects.create(
                    name=province_data["name"],
                    code=province_data["code"],
                    is_active=True
                )
                province_count += 1
                print(f"โ ุงุณุชุงู '{province_data['name']}' ุจุง ฺฉุฏ {province_data['code']} ุงุฌุงุฏ ุดุฏ")
                
                # ุงุฌุงุฏ ุดูุฑูุง ุงุณุชุงู
                cities = province_data["cities"]
                for index, city_name in enumerate(cities, 1):
                    # ฺฉุฏ ุดูุฑ: ฺฉุฏ ุงุณุชุงู + ุดูุงุฑู ุดูุฑ (2 ุฑูู)
                    city_code = f"{province_data['code']}{index:02d}"
                    City.objects.create(
                        name=city_name,
                        code=city_code,
                        province=province,
                        is_active=True
                    )
                    city_count += 1
                
                print(f"   ๐ {len(cities)} ุดูุฑ ุจุฑุง ุงุณุชุงู {province_data['name']} ุงุถุงูู ุดุฏ")
            
            print(f"\n๐ import ุจุง ููููุช ุงูุฌุงู ุดุฏ!")
            print(f"๐ ูุชุงุฌ ููุง:")
            print(f"   โข {province_count} ุงุณุชุงู ุงุฌุงุฏ ุดุฏ")
            print(f"   โข {city_count} ุดูุฑ ุงุฌุงุฏ ุดุฏ")
            
            # ุชุงุฏ ุฏุงุฏูโูุง
            db_provinces = Province.objects.count()
            db_cities = City.objects.count()
            
            print(f"\nโ ุจุฑุฑุณ ุฏุชุงุจุณ:")
            print(f"   โข ุงุณุชุงูโูุง ุฏุฑ ุฏุชุงุจุณ: {db_provinces}")
            print(f"   โข ุดูุฑูุง ุฏุฑ ุฏุชุงุจุณ: {db_cities}")
            
            if db_provinces == province_count and db_cities == city_count:
                print("\n๐ฏ ููู ุฏุงุฏูโูุง ุจุง ููููุช ุฏุฑ ุฏุชุงุจุณ ุฐุฎุฑู ุดุฏูุฏ!")
            else:
                print("\nโ๏ธ  ุชุนุฏุงุฏ ุฏุงุฏูโูุง ุฏุฑ ุฏุชุงุจุณ ูุทุงุจูุช ูุฏุงุฑุฏ!")
            
    except Exception as e:
        print(f"\nโ ุฎุทุง ุฏุฑ import ุฏุงุฏูโูุง: {str(e)}")
        import traceback
        traceback.print_exc()
        return False
    
    return True

if __name__ == "__main__":
    success = main()
    if success:
        print("\n๐ ุงุณฺฉุฑูพุช ุจุง ููููุช ุงุฌุฑุง ุดุฏ!")
        exit(0)
    else:
        print("\n๐ฅ ุงุณฺฉุฑูพุช ุจุง ุฎุทุง ููุงุฌู ุดุฏ!")
        exit(1)