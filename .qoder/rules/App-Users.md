---
trigger: always_on
alwaysApply: true
---

ادمین ها :

ادمین ها برای پنل ادمین هستند و یوزرهای معمولی برای وب سایت که ادمینها یوزرهای معمولی را مدیریت میکنند .
ثبت نام ادمین فقط در پنل ادمین فقط هست برای ثبت نام در پنل ادمین در فرم ادمینهای سوپر میتوانند و به صورت کامل تمام فیلدها پر کنند و ثبت نام انجام شه در پنل و ادمین جدید ایجاد شه با پرمیژن و دسترسی های متفاوت  وهمینطور برای ورود در پنل ادمین که فقط ادمین ها میتوانند وارد بشوند فقط با فیلد موبایل با پسورد و otp هست.

پنل ادمین با session میباشد برای ادمین و پنل ادمین
پروفایل ادمین ها جدا هست که میتوانند در پنل ادمین پر کنند یا ویرایش کنند البته در پنل ادمین برای ایجاد تمام فیلدها با هم هست 

ثب نام ادمین : با تمام فیلد ها در فرم پنل ادمین و ایمیل هم اختیاری هست
ورود : فقط با موبایل و پسورد و یا otp

یوزرهای معمولی :

ثبت نام یوزرهای برای وب سایت هست و با identifier یا با موبایل هست یا با ایمیل و موبایل با پسورد و otp و ایمیل هم با پسورد و ورود هم با همین فیلدهاست
پروفایل یوزرهای معمولی جدا هست و میتواند در پنل کاربری خودش پر کنه
یوزرهای معمولی برای وب سایت با jwt  هست.

ادمین و یوزرهای معمولی از مدیا مرکزی عکساشون نمایش و اپلود میشه و یوزرهای معمولی پروفایلشون میتونن بعد ثبت نام پر کنند و عکس بزارند و ادمینها در پنل ادمین به صورتی هست که موقغع ایجاد خوده ادمین و یا یوزر معمولی در فرم میتوانند عکس پروفایل و تمام فیلدهارو پر کنند.

ثبت نام ادمین در پنل ادمین هست فقط و اونجا کامل با عکس پروفایل و تمام فیلدها پر میشه و سطح دسترسی داده میشه و ادمین ایجاد میشه ولی یوزر های معمولی در وب سایت ثبت نام میکنند و با identifier هست اوکی یعنی با ایمیل و پسورد حالا ادمین ها میتوانند در پنل ادمین یوزر معمولی هم ایجاد کنند ولی مثل ادمین ها اونجا در پنل ادمین فرمشون یکجا پر میشه و یوزرهای معمولی ایجاد میشه پس دقتتت کن این مورد مهمیه و دقیق سریلایزها و سرویس هارو بببین دقت کن



### ماژول کاربران (`Backend/src/user`)

این اپ مسئولیت مدیریت تمام جنبه‌های مربوط به کاربران عادی و ادمین‌های سیستم را بر عهده دارد.


### مدل‌ها
- **`Admin`** (`src/user/models/admin.py`)
  - فیلدها: `email`، `mobile`، `hashed_password`، `full_name`، `is_active`، `is_protected` (برای جلوگیری از حذف ادمین‌های سیستمی)، `is_super` (دسترسی کامل و نادیده گرفتن بررسی پرمیژن‌ها).
  - روابط: چندبه‌چند با `Role`، یک‌به‌یک با `AdminProfile`.
  - محدودیت: هر ادمین باید حتماً `email` یا `mobile` داشته باشد.
- **`AdminProfile`** (`src/user/models/admin_profile.py`)
  - فیلدها: `first_name`، `last_name`، `birth_date`، `profile_picture_id` (مرتبط با مدل `Media` از اپ مدیا مرکزی).

### احراز هویت (مبتنی بر Session)
- Session در Redis از طریق `CacheService.create_admin_session` ذخیره می‌شود.
- شناسه Session در کوکی `admin_session_id` نگهداری می‌شود.
- Session از طریق `get_current_admin_session_data` بازیابی و اعتبارسنجی می‌شود.
- آبجکت ادمین فعلی از طریق `get_current_admin_user` بارگذاری می‌شود.

### سرویس‌ها
- **`AdminService`**: عملیات CRUD برای ادمین‌ها، تخصیص نقش، مدیریت وضعیت سوپرادمین، و کش کردن اطلاعات ادمین‌ها (مثلاً با `@cache_result`).
- **`AdminProfileService`**: عملیات CRUD برای پروفایل ادمین‌ها.

## 2. کاربران عادی (Regular Users)

کاربران عادی، کاربران نهایی وب‌سایت هستند و به پنل مدیریت دسترسی ندارند.

### مدل‌ها
- **`User`** (`src/user/models/user.py`)
  - فیلدها: `email`، `mobile`، `hashed_password`، `full_name`، `is_active`.
  - محدودیت: هر کاربر باید حتماً `email` یا `mobile` داشته باشد.
- **`UserProfile`** (`src/user/models/user_profile.py`)
  - فیلدها: `first_name`، `last_name`، `profile_picture_id` (مرتبط با مدل `Media`).





